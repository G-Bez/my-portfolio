<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-10-19">

<title>Portfolio - Case study - Cyclistic</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"headline",
  "consent_type":"express",
  "palette":"dark",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  });
});
</script> 
  
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-566H2H3');</script>
<!-- End Google Tag Manager -->


<link href="https://fonts.googleapis.com/css?family=Josefin+Sans:300" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Dosis:300" rel="stylesheet">

<meta property="og:title" content="My Portfolio">
<meta property="og:image" content="https://g-bez.github.io/my-portfolio/posts/Case_study_Cyclistic/opengraph_thumbnail.png">
<meta property="og:site-name" content="Portfolio">
</head><body>


<!-- ===== NAVBAR SECTION ===== -->
<nav class="navbar navbar-default navbar-expand-lg nav-menu">
  <div class="container-fluid">
    
    <button class="navbar-toggler nav-button" type="button" data-toggle="collapse" data-target="#myNavbar">
        <div class="line1 ham"></div>
        <div class="line2 ham"></div>
        <div class="line3 ham"></div>      
    </button>
      
    <div class="collapse navbar-collapse justify-content-end" id="myNavbar">
      
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link m-2 menu-item nav-active active" href="https://g-bez.github.io/my-portfolio/"> Home </a>
        </li>
        <li class="nav-item">
          <a class="nav-link m-2 menu-item nav-active active" href="https://g-bez.github.io/my-portfolio/archive.html"> Archive </a>
        </li>
      </ul>
      
      <ul class="navbar-nav ml-auto">
      </ul>
    </div>
      
  </div>
</nav>

<section class="hero-section">

</section>
<!--===== END OF NAVBAR SECTION ===== -->





<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>


<link rel="stylesheet" href="../../theme.css">
<link rel="stylesheet" href="theme.css">




<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#packages" id="toc-packages" class="nav-link" data-scroll-target="#packages">Packages</a></li>
  <li><a href="#dataset" id="toc-dataset" class="nav-link" data-scroll-target="#dataset">Dataset</a></li>
  <li><a href="#data-scraping-and-manipulation" id="toc-data-scraping-and-manipulation" class="nav-link" data-scroll-target="#data-scraping-and-manipulation">Data scraping and manipulation</a></li>
  <li><a href="#data-cleansing" id="toc-data-cleansing" class="nav-link" data-scroll-target="#data-cleansing">Data cleansing</a></li>
  <li><a href="#explorative-analysis" id="toc-explorative-analysis" class="nav-link" data-scroll-target="#explorative-analysis">Explorative analysis</a></li>
  <li><a href="#visualizations" id="toc-visualizations" class="nav-link" data-scroll-target="#visualizations">Visualizations</a></li>
  <li><a href="#findings-and-suggestions" id="toc-findings-and-suggestions" class="nav-link" data-scroll-target="#findings-and-suggestions">Findings and suggestions</a></li>
  <li><a href="#source-code" id="toc-source-code" class="nav-link" data-scroll-target="#source-code">Source code</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-566H2H3" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Case study - Cyclistic</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">R</div>
    <div class="quarto-category">Case study</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 19, 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell">
<style type="text/css">
.justify {
  text-align: justify !important
}
</style>
</div>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<div class="justify">
<p>In this case study we will perform real-world tasks of a junior data analyst, working for a fictional bike sharing company, called Cyclistic. This case study is taken from <a href="https://www.coursera.org/professional-certificates/google-data-analytics">Google data analytics professional certificate</a> on Coursera.</p>
<p>Cyclistic’s director of marketing believes the company’s future success depends on maximizing the number of annual memberships. Therefore our (fictional) team wants to understand how casual riders and annual members differ. The final goal is to design a new marketing strategy to convert casuals into members, and more specifically, we need to answer two questions:</p>
<ul>
<li>How Cyclistic can increase its revenue based on the available data?</li>
<li>How the marketing team can use social media to help with maximizing the number of members?</li>
</ul>
<p>But first the marketing team recommendations must be backed up with compelling data insights and visualizations, in order to get approved by the management.</p>
</div>
</section>
<section id="packages" class="level2">
<h2 class="anchored" data-anchor-id="packages">Packages</h2>
<div class="justify">
<p>Here is the list of packages we’ll use throughout this case study.</p>
<ul>
<li><strong>data.table</strong>: Fast data manipulation.</li>
<li><strong>lubridate</strong>: Datetime tools.</li>
<li><strong>geosphere</strong>: Spherical trigonometry for spatial applications.</li>
<li><strong>rstatix</strong>: Framework for basic statistical tests.</li>
<li><strong>robustbase</strong>: Basic robust statistics.</li>
<li><strong>ggplot2</strong>: Data visualization.</li>
<li><strong>ggmap</strong>: Spatial visualizations with for ggplot2 users.</li>
<li><strong>viridisLite</strong>: Colorblind friendly color palettes.</li>
<li><strong>patchwork</strong>: Easy plot composition for ggplot2 users.</li>
</ul>
<p>We start by loading these packages.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geosphere)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstatix)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(robustbase)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmap)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridisLite)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dataset" class="level2">
<h2 class="anchored" data-anchor-id="dataset">Dataset</h2>
<div class="justify">
<p>The relevant historical bike trip data can be downloaded from <a href="https://divvy-tripdata.s3.amazonaws.com/index.html">this url</a> (see <a href="https://www.divvybikes.com/data-license-agreement">license agreement</a>). Here we use data ranging from June 2021 to May 2022 (archives from “202106-divvy-tripdata.zip” to “202205-divvy-tripdata.zip” included).</p>
<p>Each archive contains a single monthly dataset, where each observation represents a unique bike ride. Each dataset has 13 columns/variables:</p>
<ul>
<li><strong>ride_id</strong>: alphanumeric id for each ride.</li>
<li><strong>rideable_type</strong>: Bike type. Categorical variable with 3 levels: “classic_bike”, “docked_bike”, “electric_bike”.</li>
<li><strong>member_casual</strong>: Customer type. Categorical variable with 2 levels: “casual”, “member”.</li>
<li><strong>started_at</strong>: Ride start datetime.</li>
<li><strong>ended_at</strong>: Ride end datetime.</li>
<li><strong>start_station_name</strong>: Name of the start station.</li>
<li><strong>start_station_id</strong>: Alphanumeric id for start station.</li>
<li><strong>end_station_name</strong>: Name of the end station.</li>
<li><strong>end_station_id</strong>: Alphanumeric id for end station.</li>
<li><strong>start_lat</strong>: Start latitude coordinate.</li>
<li><strong>start_lng</strong>: Start longitude coordinate.</li>
<li><strong>end_lat</strong>: End latitude coordinate.</li>
<li><strong>end_lng</strong>: End longitude coordinate.</li>
</ul>
</div>
</section>
<section id="data-scraping-and-manipulation" class="level2">
<h2 class="anchored" data-anchor-id="data-scraping-and-manipulation">Data scraping and manipulation</h2>
<div class="justify">
<p>As first step, we scrape the datasets, merge them into a total dataset, and do some manipulation. In particular we add some additional columns, computed from the existing ones:</p>
<ul>
<li><strong>ride_length</strong>: Ride length in seconds (‘ended_at’ - ‘started_at’).</li>
<li><strong>year_month</strong>: Year and month value extracted from ‘started_at’ variable.</li>
<li><strong>weekday</strong>: Day of week extracted from ‘started_at’ variable.</li>
<li><strong>ride_dist</strong>: Mileage in meters. Computed from latitude and longitude values.</li>
</ul>
<p>Then we convert ‘year_month’ and ‘member_casual’ variables into factor datatype, and ‘year_month’ into ordered factor. To accomplish these tasks we use 3 custom functions.</p>
</div>
<div class="cell">
<details>
<summary>Custom scraping and manipulation functions</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>add.cols <span class="ot">&lt;-</span> <span class="cf">function</span>(dt) {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span>(<span class="st">"data.table"</span> <span class="sc">%in%</span> <span class="fu">class</span>(dt))) <span class="fu">stop</span>(<span class="st">"dt is not a data.table object."</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">Sys.getlocale</span>(<span class="st">"LC_TIME"</span>) <span class="sc">!=</span> <span class="st">"English_United States.1252"</span>) <span class="fu">Sys.setlocale</span>(<span class="st">"LC_TIME"</span>, <span class="st">"English"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  year_month <span class="ot">&lt;-</span> <span class="fu">format</span>(dt<span class="sc">$</span>started_at, <span class="st">"%b %Y"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  weekday <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">wday</span>(dt<span class="sc">$</span>started_at, <span class="at">label =</span> T, <span class="at">abbr =</span> T, <span class="at">week_start =</span> <span class="dv">1</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  ride_length <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dt<span class="sc">$</span>ended_at <span class="sc">-</span> dt<span class="sc">$</span>started_at)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  ride_dist <span class="ot">=</span> geosphere<span class="sc">::</span><span class="fu">distGeo</span>(<span class="at">p1 =</span> dt[, <span class="fu">c</span>(<span class="st">"start_lng"</span>, <span class="st">"start_lat"</span>), <span class="at">with =</span> F], </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">p2 =</span> dt[, <span class="fu">c</span>(<span class="st">"end_lng"</span>, <span class="st">"end_lat"</span>), <span class="at">with =</span> F])</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">cbind</span>(dt, year_month, weekday, ride_length, ride_dist))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>change.datatypes <span class="ot">&lt;-</span> <span class="cf">function</span>(dt) {</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span>(<span class="st">"data.table"</span> <span class="sc">%in%</span> <span class="fu">class</span>(dt))) <span class="fu">stop</span>(<span class="st">"dt is not a data.table object."</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  dt[, <span class="fu">c</span>(<span class="st">"rideable_type"</span>, <span class="st">"member_casual"</span>)] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    dt[, <span class="fu">c</span>(<span class="st">"rideable_type"</span>, <span class="st">"member_casual"</span>)],</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    as.factor</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  dt[[<span class="st">"year_month"</span>]] <span class="ot">&lt;-</span> <span class="fu">ordered</span>(dt[[<span class="st">"year_month"</span>]], <span class="at">levels =</span> <span class="fu">unique</span>(dt<span class="sc">$</span>year_month))</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(dt)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>get.raw_data <span class="ot">&lt;-</span> <span class="cf">function</span>(Url, <span class="at">Timeout =</span> <span class="dv">60</span>) {   <span class="do">## increase timeout if you get timeout error</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  mm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"202106"</span>, <span class="st">"202107"</span>, <span class="st">"202108"</span>, <span class="st">"202109"</span>, <span class="st">"202110"</span>, <span class="st">"202111"</span>, <span class="st">"202112"</span>, <span class="st">"202201"</span>,</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>          <span class="st">"202202"</span>, <span class="st">"202203"</span>, <span class="st">"202204"</span>, <span class="st">"202205"</span>)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  url1 <span class="ot">&lt;-</span> Url</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  urls <span class="ot">&lt;-</span> <span class="fu">lapply</span>(url1, paste, mm, <span class="st">"-divvy-tripdata.zip"</span>, <span class="at">sep =</span> <span class="st">""</span>)[[<span class="dv">1</span>]]</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  ls <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">length</span>(mm))</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(ls) <span class="ot">&lt;-</span> <span class="fu">paste</span>(mm, <span class="st">"-divvy-tripdata.csv"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">options</span>(<span class="at">timeout =</span> Timeout)</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ls)) {</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    ls[[i]] <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">".zip"</span>)</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download.file</span>(urls[i], ls[[i]])</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    ls[[i]] <span class="ot">&lt;-</span> <span class="fu">unzip</span>(ls[[i]], <span class="fu">names</span>(ls)[i], <span class="at">exdir =</span> <span class="fu">tempdir</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>      data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="at">na.strings =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="cn">NA</span>))</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">options</span>(<span class="at">timeout =</span> <span class="dv">60</span>)</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  raw.tot_data <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">rbindlist</span>(ls) <span class="sc">|&gt;</span> <span class="fu">add.cols</span>() <span class="sc">|&gt;</span> <span class="fu">change.datatypes</span>() <span class="sc">|&gt;</span> </span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    data.table<span class="sc">::</span><span class="fu">setcolorder</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">13</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">16</span>,<span class="dv">14</span>,<span class="dv">15</span>,<span class="dv">5</span><span class="sc">:</span><span class="dv">12</span>,<span class="dv">17</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    data.table<span class="sc">::</span><span class="fu">setkey</span>(ride_id)</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(<span class="fu">gc</span>(<span class="at">reset =</span> T))</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(raw.tot_data)</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="justify">
<p>We call the resulting dataset ‘raw.tot_data’.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://divvy-tripdata.s3.amazonaws.com/"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>raw.tot_data <span class="ot">&lt;-</span> <span class="fu">get.raw_data</span>(url, <span class="at">Timeout =</span> <span class="dv">5000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note:
</div>
</div>
<div class="callout-body-container callout-body">
<p>The datasets are quite large (more then 5 million obs. total). If you wish to reproduce this analysis keep in mind it might take much time, even more than 1 hour with non recent hardware.</p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="data-cleansing" class="level2">
<h2 class="anchored" data-anchor-id="data-cleansing">Data cleansing</h2>
<div class="justify">
<p>As next step we do some data cleansing. We must deal with missing and bad values, which the raw dataset has plenty of.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">miss_val =</span> <span class="fu">lapply</span>(raw.tot_data, is.na) <span class="sc">|&gt;</span> <span class="fu">lapply</span>(sum))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   miss_val
ride_id            0       
rideable_type      0       
member_casual      0       
started_at         0       
ended_at           0       
ride_length        0       
year_month         0       
weekday            0       
start_station_name 823167  
start_station_id   823164  
end_station_name   878338  
end_station_id     878338  
start_lat          0       
start_lng          0       
end_lat            5036    
end_lng            5036    
ride_dist          5036    </code></pre>
</div>
</div>
<div class="justify">
<p>We use two additional custom functions to accomplish this task.</p>
</div>
<div class="cell">
<details>
<summary>Custom cleansing functions</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>rm.outliers <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span>(<span class="st">"data.table"</span> <span class="sc">%in%</span> <span class="fu">class</span>(data))) <span class="fu">stop</span>(<span class="st">"dt is not a data.table object."</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  rl.upp_whisk <span class="ot">&lt;-</span> robustbase<span class="sc">::</span><span class="fu">adjboxStats</span>(data[ride_length <span class="sc">&gt;</span> <span class="dv">0</span>, ride_length])<span class="sc">$</span>stats[<span class="dv">5</span>]</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> data[<span class="sc">-</span><span class="fu">which</span>(ride_length <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> ride_length <span class="sc">&gt;</span> rl.upp_whisk</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                    <span class="sc">|</span> (ride_dist <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> start_station_name <span class="sc">!=</span> end_station_name)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                    <span class="sc">|</span> (ride_dist <span class="sc">!=</span> <span class="dv">0</span> <span class="sc">&amp;</span> start_station_name <span class="sc">==</span> end_station_name)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                    <span class="sc">|</span> ride_dist <span class="sc">%in%</span> data[<span class="fu">order</span>(<span class="sc">-</span>ride_dist), <span class="fu">head</span>(.SD, <span class="dv">2</span>)]<span class="sc">$</span>ride_dist)]</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>rm.missing <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span>(<span class="st">"data.table"</span> <span class="sc">%in%</span> <span class="fu">class</span>(data))) <span class="fu">stop</span>(<span class="st">"dt is not a data.table object."</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> data[, <span class="fu">grep</span>(<span class="st">"*station"</span>, <span class="fu">names</span>(data)) <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df[<span class="fu">complete.cases</span>(df)]</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="justify">
<p>This is what the two functions do:</p>
<ul>
<li>Drop obs. with ‘ride_length’ &lt; 0, since negative times don’t make sense.</li>
<li>Drop obs. with ‘ride_length’ &gt; extreme of upper whisker of its boxplot adjusted for skewed distributions (see <code>robustbase::adjboxStats()</code> documentation).</li>
<li>Drop obs. with ‘ride_dist’ = 0, and ‘start_station_name’ != ‘end_station_name’, since null distance only makes sense when start station and end station are the same.</li>
<li>Drop obs. with ‘ride_dist’ != 0, and ‘start_station_name’ = ‘end_station_name’.</li>
<li>Drop the two highest ‘ride_dist’ values, since max value is physically impossible, and the second highest one, while it might make sense in theory, is also an extremely far outlier compared to other values.</li>
<li>Drop station IDs and names variables, since they have many non imputable values, and we won’t use those variables in the following analysis.</li>
<li>Drop rows with missing ‘end_lat’, ‘end_lng’ and ‘ride_dist’ values.</li>
</ul>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Arbitrarily removing observations from datasets is bad practice in real case scenarios, and might lead to strongly biased results. Always confront with your team and project stakeholders before removing any observation. However this is only a fictional case study, and this is the best we can do here.</p>
</div>
</div>
<p>We now run the two custom functions, and assign the output to ‘tot_data’. This is the final dataset we’ll use throughout the rest of the analysis. It has 5.673.722 rows and 13 columns.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>tot_data <span class="ot">&lt;-</span> raw.tot_data <span class="sc">|&gt;</span> <span class="fu">rm.outliers</span>() <span class="sc">|&gt;</span> <span class="fu">rm.missing</span>()</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(tot_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Classes 'data.table' and 'data.frame':  5673721 obs. of  13 variables:
 $ ride_id      : chr  "00000123F60251E6" "000002EBE159AE82" "0000080D43BAA9E4" "00000B4F1F71F9C2" ...
 $ rideable_type: Factor w/ 3 levels "classic_bike",..: 1 3 1 3 3 1 3 1 1 3 ...
 $ member_casual: Factor w/ 2 levels "casual","member": 2 2 1 2 2 2 2 2 1 2 ...
 $ started_at   : POSIXct, format: "2022-02-07 15:47:40" "2021-06-22 17:25:15" ...
 $ ended_at     : POSIXct, format: "2022-02-07 15:49:28" "2021-06-22 17:31:34" ...
 $ ride_length  : num  108 379 2758 376 668 ...
 $ year_month   : Ord.factor w/ 12 levels "Jun 2021"&lt;"Jul 2021"&lt;..: 9 1 3 4 12 5 11 3 2 6 ...
 $ weekday      : Ord.factor w/ 7 levels "Mon"&lt;"Tue"&lt;"Wed"&lt;..: 1 2 7 3 4 7 1 5 3 2 ...
 $ start_lat    : num  41.9 41.9 41.9 41.9 41.9 ...
 $ start_lng    : num  -87.6 -87.6 -87.6 -87.7 -87.6 ...
 $ end_lat      : num  41.9 41.9 41.9 41.9 41.9 ...
 $ end_lng      : num  -87.6 -87.6 -87.6 -87.7 -87.6 ...
 $ ride_dist    : num  361 1581 467 830 2441 ...
 - attr(*, ".internal.selfref")=&lt;externalptr&gt; 
 - attr(*, "sorted")= chr "ride_id"</code></pre>
</div>
</div>
</section>
<section id="explorative-analysis" class="level2">
<h2 class="anchored" data-anchor-id="explorative-analysis">Explorative analysis</h2>
<div class="justify">
<p>Next step is a brief exploratory analysis. We start by looking at ‘ride_length’ and ‘ride_dist’ distributions, with boxplots grouped by ‘member_casual’ variable, being the main variable of interest for this case study. Again, we use a custom function to draw the boxplots, and we apply a custom ggplot2 theme.</p>
</div>
<div class="cell">
<details>
<summary>Custom boxplot function</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>box_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(data, x, y, <span class="at">mult=</span><span class="dv">1</span>, <span class="at">Fill =</span> <span class="st">"thistle2"</span>, <span class="at">outl.size =</span> <span class="fl">0.2</span>, <span class="at">Notch =</span> F, <span class="at">Coef =</span> <span class="fl">1.5</span>, </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stat =</span> <span class="st">"mean"</span>, <span class="at">Breaks =</span> <span class="fu">waiver</span>(), <span class="at">Title =</span> <span class="st">"Title"</span>, <span class="at">Subtitle =</span> <span class="fu">waiver</span>(), </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">x.lab =</span> <span class="st">"x-axis label"</span>, <span class="at">y.lab =</span> <span class="st">"y-axis label"</span>) {</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> <span class="fu">parse</span>(<span class="at">text =</span> x)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">=</span> <span class="fu">parse</span>(<span class="at">text =</span> y)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  box <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">eval</span>(x), <span class="at">y =</span> <span class="fu">eval</span>(y)<span class="sc">*</span>mult)) <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="at">outlier.size =</span> outl.size, <span class="at">fill =</span> Fill, <span class="at">notch =</span> Notch, <span class="at">coef =</span> Coef) <span class="sc">+</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_summary</span>(<span class="at">fun =</span> stat) <span class="sc">+</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> Breaks) <span class="sc">+</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(Title, Subtitle) <span class="sc">+</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(x.lab) <span class="sc">+</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(y.lab)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(box)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Custom ggplot2 theme</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_update</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"grey85"</span>),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"whitesmoke"</span>),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"italic"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"grey85"</span>),</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="justify">
<p>Below you can see the resulting plots:</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>rl_box <span class="ot">&lt;-</span> <span class="fu">box_plot</span>(tot_data, <span class="st">"member_casual"</span>, <span class="st">"ride_length"</span>, <span class="at">mult =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">60</span>,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Fill =</span>  viridisLite<span class="sc">::</span><span class="fu">turbo</span>(<span class="dv">25</span>)[<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">16</span>)], <span class="at">Notch =</span> T, <span class="at">Breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">90</span>,<span class="dv">5</span>), </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Title =</span> <span class="st">"Ride length boxplots"</span>, <span class="at">x.lab =</span> <span class="st">"Membership"</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">y.lab =</span> <span class="st">"Ride length (min.)"</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>rd_box <span class="ot">&lt;-</span> <span class="fu">box_plot</span>(tot_data, <span class="st">"member_casual"</span>, <span class="st">"ride_dist"</span>, <span class="at">mult =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Fill =</span>  viridisLite<span class="sc">::</span><span class="fu">turbo</span>(<span class="dv">25</span>)[<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">16</span>)], <span class="at">Notch =</span> T, <span class="at">Breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">35</span>,<span class="fl">2.5</span>), </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Title =</span> <span class="st">"Ride dist boxplots"</span>, <span class="at">x.lab =</span> <span class="st">"Membership"</span>, </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">y.lab =</span> <span class="st">"Ride distance (km)"</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>rl_box <span class="sc">+</span> rd_box <span class="co"># patchwork composition</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/boxplots-1.png" style="width:90.0%;height:90.0%"></p>
</div>
</div>
<div class="justify">
<p>All the four distributions are heavily right skewed, with mean (black dot) &gt; median, long upper whiskers and many outliers on the upper side.</p>
<p>Looking at ‘ride_length’ plot, we notice casuals group has higher variance than members one, since casuals box is wider. Also, all casuals boxplot statistics have higher values than their members counterparts. Hence it seems like casual customers have a tendency to take longer rides, and more diverse use cases for Cyclistic’s bikes. Conversely, the two ‘ride_dist’ boxplots look very similar, suggesting the two groups cover the same distance on average. Additional more formal analysis is required here in order to draw conclusions. This preliminar graphical analysis suggests members are more likely to use Cyclistic’s bikes for daily routine tasks, like commuting to work, compared to casual customers who occasionally rent them for leisure. Moreover, from the boxplots results, it’s clear that the current Cyclistic strategy doesn’t profit from ‘ride_length’, since members, being the most profitable group, take shorter rides.</p>
<p>As next step we compute some summary statistics for ‘ride_length’ and ‘rideable_type’ variables. We’ll use them later to draw additional visualizations. Again we write a custom function to do it, in order to save keystrokes.</p>
</div>
<div class="cell">
<details>
<summary>Custom summary function</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>Summ <span class="ot">&lt;-</span> <span class="cf">function</span>(data, var, group_by, <span class="at">order_by =</span> group_by) {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span>(<span class="st">"data.table"</span> <span class="sc">%in%</span> <span class="fu">class</span>(data))) <span class="fu">stop</span>(<span class="st">"dt is not a data.table object."</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> <span class="fu">parse</span>(<span class="at">text =</span> var)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  summ <span class="ot">=</span> data[</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    ,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    .(<span class="at">obs =</span> <span class="fu">NROW</span>(<span class="fu">eval</span>(x)), <span class="at">quart1 =</span> <span class="fu">quantile</span>(<span class="fu">eval</span>(x), <span class="fl">0.25</span>), <span class="at">mean =</span> <span class="fu">mean</span>(<span class="fu">eval</span>(x)), </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">median =</span> <span class="fu">median</span>(<span class="fu">eval</span>(x)), <span class="at">quart3 =</span> <span class="fu">quantile</span>(<span class="fu">eval</span>(x), <span class="fl">0.75</span>), <span class="at">iqr =</span> <span class="fu">IQR</span>(<span class="fu">eval</span>(x)),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">stdev =</span> <span class="fu">sd</span>(<span class="fu">eval</span>(x))), </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    by <span class="ot">=</span> group_by</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  ] <span class="sc">|&gt;</span> data.table<span class="sc">::</span><span class="fu">setorderv</span>(<span class="at">cols =</span> order_by)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(summ)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>rl_summ_by_ym <span class="ot">&lt;-</span> <span class="fu">Summ</span>(tot_data, <span class="st">"ride_length"</span>, <span class="fu">c</span>(<span class="st">"member_casual"</span>, <span class="st">"year_month"</span>))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>rl_summ_by_wd <span class="ot">&lt;-</span> <span class="fu">Summ</span>(tot_data, <span class="st">"ride_length"</span>, <span class="fu">c</span>(<span class="st">"member_casual"</span>, <span class="st">"weekday"</span>))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>rt_summ <span class="ot">&lt;-</span> tot_data[, .(<span class="at">obs =</span> .N), by <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"member_casual"</span>, <span class="st">"rideable_type"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="tabset-margin-container"></div><div id="summaries" class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">rl_summ_by_ym</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">rl_summ_by_wd</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">rt_summ</a></li></ul>
<div id="summaries" class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>rl_summ_by_ym</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    member_casual year_month    obs quart1      mean median quart3    iqr
 1:        casual   Jun 2021 343553  576.0 1283.0834    979   1673 1097.0
 2:        casual   Jul 2021 413932  561.0 1245.7968    950   1619 1058.0
 3:        casual   Aug 2021 388833  545.0 1213.8663    921   1575 1030.0
 4:        casual   Sep 2021 344914  522.0 1178.2975    883   1525 1003.0
 5:        casual   Oct 2021 244740  468.0 1078.4636    793   1389  921.0
 6:        casual   Nov 2021 102833  395.0  918.5119    660   1162  767.0
 7:        casual   Dec 2021  67023  387.5  892.8884    643   1132  744.5
 8:        casual   Jan 2022  17810  363.0  805.6264    590   1008  645.0
 9:        casual   Feb 2022  20405  387.0  880.3110    632   1110  723.0
10:        casual   Mar 2022  84746  460.0 1127.8093    816   1489 1029.0
11:        casual   Apr 2022 119640  452.0 1099.3256    795   1439  987.0
12:        casual   May 2022 262577  501.0 1185.9838    875   1550 1049.0
13:        member   Jun 2021 354758  373.0  817.9696    636   1075  702.0
14:        member   Jul 2021 376543  365.0  802.9104    625   1052  687.0
15:        member   Aug 2021 387775  357.0  793.4779    608   1037  680.0
16:        member   Sep 2021 388197  343.0  770.8177    587   1002  659.0
17:        member   Oct 2021 369407  307.0  698.4691    519    893  586.0
18:        member   Nov 2021 249856  277.0  629.5316    461    787  510.0
19:        member   Dec 2021 175515  275.0  620.9361    457    782  507.0
20:        member   Jan 2022  84244  279.0  608.3621    448    753  474.0
21:        member   Feb 2022  93157  275.0  616.9100    451    766  491.0
22:        member   Mar 2022 191845  284.0  662.8775    482    839  555.0
23:        member   Apr 2022 241999  277.0  651.5632    474    826  549.0
24:        member   May 2022 349419  322.0  755.8451    564    983  661.0
    member_casual year_month    obs quart1      mean median quart3    iqr
        stdev
 1: 1003.7459
 2:  978.9981
 3:  961.0095
 4:  949.0889
 5:  898.0429
 6:  798.8552
 7:  773.8583
 8:  701.4893
 9:  774.1430
10:  956.9421
11:  936.7498
12:  985.0330
13:  636.7139
14:  630.3621
15:  632.8731
16:  620.8099
17:  585.3930
18:  540.6631
19:  528.8499
20:  519.2169
21:  537.1952
22:  575.2290
23:  568.6321
24:  632.8844
        stdev</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>rl_summ_by_wd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    member_casual weekday    obs quart1      mean median  quart3     iqr
 1:        casual     Mon 282856    495 1178.6815    865 1546.00 1051.00
 2:        casual     Tue 272242    462 1066.9628    780 1360.00  898.00
 3:        casual     Wed 272028    464 1057.6846    780 1350.00  886.00
 4:        casual     Thu 293717    468 1061.7332    783 1352.00  884.00
 5:        casual     Fri 342166    491 1119.2363    833 1445.75  954.75
 6:        casual     Sat 511457    570 1270.2624    976 1667.00 1097.00
 7:        casual     Sun 436540    574 1300.8242    996 1710.00 1136.00
 8:        member     Mon 460809    308  708.8109    525  910.00  602.00
 9:        member     Tue 519256    308  690.7078    520  887.00  579.00
10:        member     Wed 507258    312  697.7463    528  897.00  585.00
11:        member     Thu 496600    312  699.4487    528  901.00  589.00
12:        member     Fri 454393    315  713.9517    537  921.00  606.00
13:        member     Sat 435214    349  811.2369    614 1063.00  714.00
14:        member     Sun 389185    342  815.4492    607 1074.00  732.00
        stdev
 1:  977.6261
 2:  901.7131
 3:  884.0924
 4:  886.1289
 5:  918.3581
 6:  989.3016
 7: 1018.5658
 8:  595.1113
 9:  565.8532
10:  569.0408
11:  572.8629
12:  588.8620
13:  665.4548
14:  681.0527</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>rt_summ</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   member_casual rideable_type     obs
1:        member  classic_bike 1974193
2:        member electric_bike 1288522
3:        casual  classic_bike 1182884
4:        casual   docked_bike  235153
5:        casual electric_bike  992969</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="justify">
<p>As final step of our exploratory data analysis, we perform Welch’s t-tests on ‘ride_length’ and ‘ride_dist’ variables means, with ‘member_casual’ being the grouping factor. We also compute Cohen’s D estimates to see the actual effect size of ‘member_casual’ on the other two variables.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note:
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Since we have a very large dataset, Welch’s tests will almost certainly reject the null hypothesis of equal population means for member and casual customers. That’s why we also estimate the actual effect sizes of ‘member_casual’ variable with Cohen’s d statistics.</p>
</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>welch_rl <span class="ot">&lt;-</span> <span class="fu">t.test</span>(ride_length <span class="sc">~</span> member_casual, <span class="at">data =</span> tot_data)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>welch_rd <span class="ot">&lt;-</span> <span class="fu">t.test</span>(ride_dist <span class="sc">~</span> member_casual, <span class="at">data =</span> tot_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="tabset-margin-container"></div><div id="welch" class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">welch_rl</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">welch_rd</a></li></ul>
<div id="welch" class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>welch_rl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  ride_length by member_casual
t = 630.05, df = 3806121, p-value &lt; 2.2e-16
alternative hypothesis: true difference in means between group casual and group member is not equal to 0
95 percent confidence interval:
 440.0178 442.7640
sample estimates:
mean in group casual mean in group member 
           1171.2742             729.8833 </code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>welch_rd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  ride_dist by member_casual
t = 123.77, df = 5074284, p-value &lt; 2.2e-16
alternative hypothesis: true difference in means between group casual and group member is not equal to 0
95 percent confidence interval:
 199.2456 205.6576
sample estimates:
mean in group casual mean in group member 
            2303.351             2100.899 </code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="justify">
<p>As expected, both tests reject the null hypothesis of equal population means. So let’s see how strong the relationships between ‘member_casuals’, and ‘ride_dist’ and ‘ride_length’ variables actually are. Relying on the two boxplots, we can assume a moderate to high effect size on ‘ride_length’ variable, and a small effect size on ‘ride_dist’ variable.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>cohensD_rl <span class="ot">&lt;-</span> rstatix<span class="sc">::</span><span class="fu">cohens_d</span>(ride_length <span class="sc">~</span> member_casual, <span class="at">data =</span> tot_data)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>cohensD_rd <span class="ot">&lt;-</span> rstatix<span class="sc">::</span><span class="fu">cohens_d</span>(ride_dist <span class="sc">~</span> member_casual, <span class="at">data =</span> tot_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="tabset-margin-container"></div><div id="cohensD" class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">cohensD_rl</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">cohensD_rd</a></li></ul>
<div id="cohensD" class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>cohensD_rl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  .y.         group1 group2 effsize      n1      n2 magnitude
* &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt; &lt;ord&gt;    
1 ride_length casual member   0.552 2411006 3262715 moderate </code></pre>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>cohensD_rd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  .y.       group1 group2 effsize      n1      n2 magnitude 
* &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt; &lt;ord&gt;     
1 ride_dist casual member   0.105 2411006 3262715 negligible</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="justify">
<p>As expected, our assumptions about effect sizes turned out correct. ‘member_casual’ has a moderate effect size on ‘ride_length’ variable, and a negligible effect on ‘ride_dist’. That’s more evidence supporting our previous findings about the two types of customers: casuals tend to take significantly longer rides and are more likely to use Cyclistic bikes for leisure.</p>
</div>
</section>
<section id="visualizations" class="level2">
<h2 class="anchored" data-anchor-id="visualizations">Visualizations</h2>
<div class="justify">
<p>Last step of our analysis consists of some additional visualizations about the total number of rides, and some maps.</p>
</div>
<div class="cell">
<details>
<summary>Custom visualiz. functions</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>col_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(data, x, y, group, <span class="at">mult =</span> <span class="dv">1</span>, <span class="at">Legend =</span> F, <span class="at">text_vjust =</span> <span class="dv">0</span>, <span class="at">text_col =</span> <span class="st">"black"</span>, </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">text_fface =</span> <span class="st">"bold"</span>, <span class="at">text.size =</span> <span class="fl">2.5</span>, <span class="at">facet_nrow =</span> <span class="dv">2</span>, <span class="at">facet_strip =</span> <span class="st">"right"</span>, </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Breaks =</span> <span class="fu">waiver</span>(), <span class="at">col_man =</span> <span class="fu">rep</span>(<span class="st">"black"</span>, facet_nrow), </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Fill_man =</span> <span class="fu">rep</span>(<span class="st">"thistle2"</span>, facet_nrow), <span class="at">Title =</span> <span class="st">"Title"</span>, <span class="at">Subtitle =</span> <span class="fu">waiver</span>(), </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">x.lab =</span> <span class="st">"x-axis label"</span>, <span class="at">y.lab =</span> <span class="st">"y-axis label"</span>, <span class="at">Round =</span> <span class="dv">2</span>, <span class="at">Angle =</span> <span class="dv">0</span>) {</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> <span class="fu">parse</span>(<span class="at">text =</span> x)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">=</span> <span class="fu">parse</span>(<span class="at">text =</span> y)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  group <span class="ot">=</span> <span class="fu">parse</span>(<span class="at">text =</span> group)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  col <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">eval</span>(x), <span class="at">y =</span> <span class="fu">eval</span>(y)<span class="sc">*</span>mult)) <span class="sc">+</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">eval</span>(group), <span class="at">fill =</span> <span class="fu">eval</span>(group)), <span class="at">show.legend =</span> Legend) <span class="sc">+</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(<span class="fu">eval</span>(y)<span class="sc">*</span>mult, Round)), </span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">vjust =</span> text_vjust, </span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">colour =</span> text_col, </span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">fontface =</span> text_fface, </span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> text.size) <span class="sc">+</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span><span class="fu">eval</span>(group), <span class="at">nrow =</span> facet_nrow, <span class="at">strip.position =</span> facet_strip) <span class="sc">+</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> Breaks) <span class="sc">+</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> col_man) <span class="sc">+</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> Fill_man) <span class="sc">+</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> Angle)) <span class="sc">+</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(Title, Subtitle) <span class="sc">+</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(x.lab) <span class="sc">+</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(y.lab)</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(col)</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>map_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(data, lng, lat, group, <span class="at">Zoom =</span> <span class="dv">11</span>, <span class="at">Crop =</span> F, <span class="at">Type =</span> <span class="st">"toner-lite"</span>, <span class="at">transp =</span> <span class="fl">0.05</span>,</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dot.size =</span> <span class="fl">0.85</span>, <span class="at">col_man =</span> <span class="st">"black"</span>, <span class="at">fill_man =</span> <span class="st">"black"</span>, <span class="at">x.lab =</span> <span class="st">"longitude"</span>,</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y.lab =</span> <span class="st">"latitude"</span>, <span class="at">Title =</span> <span class="st">"map"</span>) {</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>  lng <span class="ot">=</span> <span class="fu">parse</span>(<span class="at">text =</span> lng)</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>  lat <span class="ot">=</span> <span class="fu">parse</span>(<span class="at">text =</span> lat)</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>  group <span class="ot">=</span> <span class="fu">parse</span>(<span class="at">text =</span> group)</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>  map.lim <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">min</span>(data[, <span class="fu">eval</span>(lng)]), <span class="fu">min</span>(data[, <span class="fu">eval</span>(lat)]), </span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>              <span class="fu">max</span>(data[, <span class="fu">eval</span>(lng)]), <span class="fu">max</span>(data[, <span class="fu">eval</span>(lat)]))</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>  map <span class="ot">=</span> <span class="fu">get_stamenmap</span>(<span class="at">bbox =</span> map.lim, <span class="at">zoom =</span> Zoom, <span class="at">maptype =</span> Type, <span class="at">crop =</span> Crop)</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>  map.plot <span class="ot">&lt;-</span> ggmap<span class="sc">::</span><span class="fu">ggmap</span>(map) <span class="sc">+</span></span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> data, </span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">eval</span>(lng), <span class="at">y =</span> <span class="fu">eval</span>(lat), <span class="at">fill =</span> <span class="fu">eval</span>(group), <span class="at">colour =</span> <span class="fu">eval</span>(group)),</span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> transp, <span class="at">size =</span> dot.size) <span class="sc">+</span></span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> col_man) <span class="sc">+</span></span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> fill_man) <span class="sc">+</span></span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">1.5</span>))) <span class="sc">+</span></span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>(), <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.80</span>, <span class="fl">0.90</span>),</span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(x.lab) <span class="sc">+</span></span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(y.lab) <span class="sc">+</span></span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="at">label =</span> Title)</span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(map.plot)</span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="justify">
<p>Below you can look at column plots for number of rides by month and by day of week, both grouped by ‘member_casual’.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>nr.ym <span class="ot">&lt;-</span> <span class="fu">col_plot</span>(rl_summ_by_ym, <span class="st">"year_month"</span>, <span class="st">"obs"</span>, <span class="st">"member_casual"</span>, <span class="at">mult =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">text_vjust =</span> <span class="fl">1.2</span>, <span class="at">Breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">500</span>, <span class="dv">50</span>), <span class="at">Title =</span> <span class="st">"Num. rides by month"</span>,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Fill_man =</span> viridisLite<span class="sc">::</span><span class="fu">turbo</span>(<span class="dv">25</span>)[<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">16</span>)], <span class="at">x.lab =</span> <span class="st">"Month"</span>,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y.lab =</span> <span class="st">"Num. rides (thousands)"</span>, <span class="at">Round =</span> <span class="dv">0</span>, <span class="at">Angle =</span> <span class="dv">90</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>nr.wd <span class="ot">&lt;-</span> <span class="fu">col_plot</span>(rl_summ_by_wd, <span class="st">"weekday"</span>, <span class="st">"obs"</span>, <span class="st">"member_casual"</span>, <span class="at">mult =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">text_vjust =</span> <span class="dv">5</span>, <span class="at">Breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">500</span>, <span class="dv">50</span>), <span class="at">Title =</span> <span class="st">"Num. rides by weekday"</span>,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Fill_man =</span> viridisLite<span class="sc">::</span><span class="fu">turbo</span>(<span class="dv">25</span>)[<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">16</span>)], <span class="at">x.lab =</span> <span class="st">"Weekday"</span>,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y.lab =</span> <span class="st">"Num. rides (thousands)"</span>, <span class="at">Round =</span> <span class="dv">0</span>)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>nr.ym <span class="sc">+</span> nr.wd <span class="co">#patchwork composition</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/ride_length colplots-1.png" style="width:90.0%;height:90.0%"></p>
</div>
</div>
<div class="justify">
<p>These plots are quite interesting. The first one shows an obvious decline of the number of rides in cold seasons, for both casual and member customers, but the decline is steeper for casual riders. The second plot shows plain different trends in the number of rides by day of week: casuals do ride more during the weekend, while members have an opposite trend, with maximum number of rides during mid-week, and a decline towards the weekend. Those are pretty strong evidences that annual members mostly use Cyclistic bike sharing service to commute to work, while casuals rent bikes for leisure, mainly.</p>
<p>With the following column plot we also take a look at customers preferences about bike types.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>nr.rt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(rt_summ, <span class="fu">aes</span>(<span class="at">x =</span> rideable_type, <span class="at">y =</span> obs<span class="sc">/</span><span class="dv">1000</span>)) <span class="sc">+</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> member_casual), <span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">group =</span> member_casual, <span class="at">label =</span> <span class="fu">round</span>(obs<span class="sc">/</span><span class="dv">1000</span>)), </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="at">width =</span> <span class="dv">1</span>),</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="dv">2</span>, <span class="at">fontface =</span> <span class="st">"bold"</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> viridisLite<span class="sc">::</span><span class="fu">turbo</span>(<span class="dv">25</span>)[<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">16</span>)]) <span class="sc">+</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">85</span>, .<span class="dv">85</span>), <span class="at">legend.title =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Num. rides (thousands)"</span>) <span class="sc">+</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Bike type"</span>) <span class="sc">+</span> </span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Num. rides by bike type"</span>)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>nr.rt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/bike type colplot-1.png" style="width:90.0%;height:90.0%"></p>
</div>
</div>
<div class="justify">
<p>As we can see, docked bikes ar by far the least popular category, and more important, those are only used by casual customers. It makes sense in accordance to previous findings, that annual members prefer the flexibility of non-docked bikes when commuting to work.</p>
<p>Eventually, we draw two maps paired with scatterplots of start and end coordinates.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>start_map <span class="ot">&lt;-</span> <span class="fu">map_plot</span>(tot_data, <span class="st">"start_lng"</span>, <span class="st">"start_lat"</span>, <span class="st">"member_casual"</span>,</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">col_man =</span> viridisLite<span class="sc">::</span><span class="fu">turbo</span>(<span class="dv">25</span>)[<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">16</span>)], </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">fill_man =</span> viridisLite<span class="sc">::</span><span class="fu">turbo</span>(<span class="dv">25</span>)[<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">16</span>)], <span class="at">Title =</span> <span class="st">"Start map"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `size` argument of `element_rect()` is deprecated as of ggplot2 3.4.0.
ℹ Please use the `linewidth` argument instead.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>end_map <span class="ot">&lt;-</span> <span class="fu">map_plot</span>(tot_data, <span class="st">"end_lng"</span>, <span class="st">"end_lat"</span>, <span class="st">"member_casual"</span>,</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">col_man =</span> viridisLite<span class="sc">::</span><span class="fu">turbo</span>(<span class="dv">25</span>)[<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">16</span>)], </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fill_man =</span> viridisLite<span class="sc">::</span><span class="fu">turbo</span>(<span class="dv">25</span>)[<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">16</span>)], <span class="at">Title =</span> <span class="st">"End map"</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>start_map <span class="sc">+</span> end_map <span class="co">#patchwork composition</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/maps-1.png" style="width:90.0%;height:90.0%"></p>
</div>
</div>
<div class="justify">
<p>The two maps clearly show that member customers are Chicago locals mainly, while casuals are more dispersed and more likely to be tourists.</p>
</div>
</section>
<section id="findings-and-suggestions" class="level2">
<h2 class="anchored" data-anchor-id="findings-and-suggestions">Findings and suggestions</h2>
<div class="justify">
<p>Based on the previous analysis we can conclude that:</p>
<ul>
<li>Most member customers are Chicago locals and use Cyclistic bikes for daily routine activities, especially to commute to work.</li>
<li>Casual customers are more dispersed, use Cyclistic bikes for leisure, and are more likely to be tourists.</li>
</ul>
<p>Being the two groups fundamentally different between each other, it might be hard to convert casuals into members. However we can provide some potentially useful suggestions anyway:</p>
<ul>
<li>Gather more data on casual riders with surveys. Ask about their home addresses, daily habits, work, etc.</li>
<li>Develop a dedicated social media campaign targeted at casual customers on weekends, specifically. A clever and low-cost idea might be asking the customers to share their weekend rides with Cyclistic on social media (in exchange for some discounts, etc.).</li>
<li>Adopt a more flexible pricing structure, by offering something like a weekend-only membership. Also develop a plan to charge casual customers based on ‘ride_length’.</li>
<li>Consider cutting investments on docked bikes, and focus on non-docked ones.</li>
<li>Consider an expansion to Chicago neighborhoods.</li>
<li>Consider partnerships with local enterprises, like offering discounted memberships for employees.</li>
</ul>
</div>
</section>
<section id="source-code" class="level2">
<h2 class="anchored" data-anchor-id="source-code">Source code</h2>
<div class="justify">
<p>For a different take on this same case study, look at the <a href="https://github.com/G-Bez/Cyclistic-case-study">source code</a> I uploaded to github, where I also used <a href="https://rstudio.github.io/renv/articles/renv.html">renv</a> for dependency management, and <a href="https://books.ropensci.org/targets/">targets</a> for workflow management. Follow the instructions in order to reproduce the analysis.</p>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="G-Bez/my-portfolio" issue-term="pathname" theme="photon-dark" crossorigin="anonymous" async="">
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb36" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Case study - Cyclistic"</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2022-10-19"</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [R, Case study]</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> cyclistic_thumbnail.jpeg</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="co">    fontsize: 0.9em</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co">    include-in-header: navbar.html</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="co">    css: theme.css</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="an">comments:</span><span class="co"> </span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="co">    utterances: </span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="co">      repo:  G-Bez/my-portfolio </span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="co">      theme: photon-dark</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="an">title-block-banner:</span><span class="co"> false</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="in">```{css, echo = FALSE}</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">justify</span> <span class="op">{</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>  text<span class="op">-</span>align<span class="op">:</span> justify <span class="op">!</span>important</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>::: justify</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>In this case study we will perform real-world tasks of a junior data analyst, working for a fictional bike sharing company, called Cyclistic. This case study is taken from <span class="co">[</span><span class="ot">Google data analytics professional certificate</span><span class="co">](https://www.coursera.org/professional-certificates/google-data-analytics)</span> on Coursera.</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>Cyclistic's director of marketing believes the company's future success depends on maximizing the number of annual memberships. Therefore our (fictional) team wants to understand how casual riders and annual members differ. The final goal is to design a new marketing strategy to convert casuals into members, and more specifically, we need to answer two questions:</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>How Cyclistic can increase its revenue based on the available data?</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>How the marketing team can use social media to help with maximizing the number of members?</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>But first the marketing team recommendations must be backed up with compelling data insights and visualizations, in order to get approved by the management.</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a><span class="fu">## Packages</span></span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>::: justify</span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>Here is the list of packages we'll use throughout this case study.</span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**data.table**: Fast data manipulation.</span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**lubridate**: Datetime tools.</span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**geosphere**: Spherical trigonometry for spatial applications.</span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**rstatix**: Framework for basic statistical tests.</span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**robustbase**: Basic robust statistics.</span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**ggplot2**: Data visualization.</span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**ggmap**: Spatial visualizations with for ggplot2 users.</span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**viridisLite**: Colorblind friendly color palettes.</span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**patchwork**: Easy plot composition for ggplot2 users.</span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a>We start by loading these packages.</span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Packages}</span></span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geosphere)</span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstatix)</span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(robustbase)</span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmap)</span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridisLite)</span>
<span id="cb36-68"><a href="#cb36-68" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb36-69"><a href="#cb36-69" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-70"><a href="#cb36-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-71"><a href="#cb36-71" aria-hidden="true" tabindex="-1"></a><span class="fu">## Dataset</span></span>
<span id="cb36-72"><a href="#cb36-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-73"><a href="#cb36-73" aria-hidden="true" tabindex="-1"></a>::: justify</span>
<span id="cb36-74"><a href="#cb36-74" aria-hidden="true" tabindex="-1"></a>The relevant historical bike trip data can be downloaded from <span class="co">[</span><span class="ot">this url</span><span class="co">](https://divvy-tripdata.s3.amazonaws.com/index.html)</span> (see <span class="co">[</span><span class="ot">license agreement</span><span class="co">](https://www.divvybikes.com/data-license-agreement)</span>). Here we use data ranging from June 2021 to May 2022 (archives from "202106-divvy-tripdata.zip" to "202205-divvy-tripdata.zip" included).</span>
<span id="cb36-75"><a href="#cb36-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-76"><a href="#cb36-76" aria-hidden="true" tabindex="-1"></a>Each archive contains a single monthly dataset, where each observation represents a unique bike ride. Each dataset has 13 columns/variables:</span>
<span id="cb36-77"><a href="#cb36-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-78"><a href="#cb36-78" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**ride_id**: alphanumeric id for each ride.</span>
<span id="cb36-79"><a href="#cb36-79" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**rideable_type**: Bike type. Categorical variable with 3 levels: "classic_bike", "docked_bike", "electric_bike".</span>
<span id="cb36-80"><a href="#cb36-80" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**member_casual**: Customer type. Categorical variable with 2 levels: "casual", "member".</span>
<span id="cb36-81"><a href="#cb36-81" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**started_at**: Ride start datetime.</span>
<span id="cb36-82"><a href="#cb36-82" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**ended_at**: Ride end datetime.</span>
<span id="cb36-83"><a href="#cb36-83" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**start_station_name**: Name of the start station.</span>
<span id="cb36-84"><a href="#cb36-84" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**start_station_id**: Alphanumeric id for start station.</span>
<span id="cb36-85"><a href="#cb36-85" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**end_station_name**: Name of the end station.</span>
<span id="cb36-86"><a href="#cb36-86" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**end_station_id**: Alphanumeric id for end station.</span>
<span id="cb36-87"><a href="#cb36-87" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**start_lat**: Start latitude coordinate.</span>
<span id="cb36-88"><a href="#cb36-88" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**start_lng**: Start longitude coordinate.</span>
<span id="cb36-89"><a href="#cb36-89" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**end_lat**: End latitude coordinate.</span>
<span id="cb36-90"><a href="#cb36-90" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**end_lng**: End longitude coordinate.</span>
<span id="cb36-91"><a href="#cb36-91" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-92"><a href="#cb36-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-93"><a href="#cb36-93" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data scraping and manipulation</span></span>
<span id="cb36-94"><a href="#cb36-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-95"><a href="#cb36-95" aria-hidden="true" tabindex="-1"></a>::: justify</span>
<span id="cb36-96"><a href="#cb36-96" aria-hidden="true" tabindex="-1"></a>As first step, we scrape the datasets, merge them into a total dataset, and do some manipulation. In particular we add some additional columns, computed from the existing ones:</span>
<span id="cb36-97"><a href="#cb36-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-98"><a href="#cb36-98" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**ride_length**: Ride length in seconds ('ended_at' - 'started_at').</span>
<span id="cb36-99"><a href="#cb36-99" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**year_month**: Year and month value extracted from 'started_at' variable.</span>
<span id="cb36-100"><a href="#cb36-100" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**weekday**: Day of week extracted from 'started_at' variable.</span>
<span id="cb36-101"><a href="#cb36-101" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**ride_dist**: Mileage in meters. Computed from latitude and longitude values.</span>
<span id="cb36-102"><a href="#cb36-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-103"><a href="#cb36-103" aria-hidden="true" tabindex="-1"></a>Then we convert 'year_month' and 'member_casual' variables into factor datatype, and 'year_month' into ordered factor. To accomplish these tasks we use 3 custom functions.</span>
<span id="cb36-104"><a href="#cb36-104" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-105"><a href="#cb36-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-106"><a href="#cb36-106" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Scrape and manipulate data func}</span></span>
<span id="cb36-107"><a href="#cb36-107" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb36-108"><a href="#cb36-108" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Custom scraping and manipulation functions"</span></span>
<span id="cb36-109"><a href="#cb36-109" aria-hidden="true" tabindex="-1"></a>add.cols <span class="ot">&lt;-</span> <span class="cf">function</span>(dt) {</span>
<span id="cb36-110"><a href="#cb36-110" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span>(<span class="st">"data.table"</span> <span class="sc">%in%</span> <span class="fu">class</span>(dt))) <span class="fu">stop</span>(<span class="st">"dt is not a data.table object."</span>)</span>
<span id="cb36-111"><a href="#cb36-111" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">Sys.getlocale</span>(<span class="st">"LC_TIME"</span>) <span class="sc">!=</span> <span class="st">"English_United States.1252"</span>) <span class="fu">Sys.setlocale</span>(<span class="st">"LC_TIME"</span>, <span class="st">"English"</span>)</span>
<span id="cb36-112"><a href="#cb36-112" aria-hidden="true" tabindex="-1"></a>  year_month <span class="ot">&lt;-</span> <span class="fu">format</span>(dt<span class="sc">$</span>started_at, <span class="st">"%b %Y"</span>)</span>
<span id="cb36-113"><a href="#cb36-113" aria-hidden="true" tabindex="-1"></a>  weekday <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">wday</span>(dt<span class="sc">$</span>started_at, <span class="at">label =</span> T, <span class="at">abbr =</span> T, <span class="at">week_start =</span> <span class="dv">1</span>)</span>
<span id="cb36-114"><a href="#cb36-114" aria-hidden="true" tabindex="-1"></a>  ride_length <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dt<span class="sc">$</span>ended_at <span class="sc">-</span> dt<span class="sc">$</span>started_at)</span>
<span id="cb36-115"><a href="#cb36-115" aria-hidden="true" tabindex="-1"></a>  ride_dist <span class="ot">=</span> geosphere<span class="sc">::</span><span class="fu">distGeo</span>(<span class="at">p1 =</span> dt[, <span class="fu">c</span>(<span class="st">"start_lng"</span>, <span class="st">"start_lat"</span>), <span class="at">with =</span> F], </span>
<span id="cb36-116"><a href="#cb36-116" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">p2 =</span> dt[, <span class="fu">c</span>(<span class="st">"end_lng"</span>, <span class="st">"end_lat"</span>), <span class="at">with =</span> F])</span>
<span id="cb36-117"><a href="#cb36-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">cbind</span>(dt, year_month, weekday, ride_length, ride_dist))</span>
<span id="cb36-118"><a href="#cb36-118" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-119"><a href="#cb36-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-120"><a href="#cb36-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-121"><a href="#cb36-121" aria-hidden="true" tabindex="-1"></a>change.datatypes <span class="ot">&lt;-</span> <span class="cf">function</span>(dt) {</span>
<span id="cb36-122"><a href="#cb36-122" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span>(<span class="st">"data.table"</span> <span class="sc">%in%</span> <span class="fu">class</span>(dt))) <span class="fu">stop</span>(<span class="st">"dt is not a data.table object."</span>)</span>
<span id="cb36-123"><a href="#cb36-123" aria-hidden="true" tabindex="-1"></a>  dt[, <span class="fu">c</span>(<span class="st">"rideable_type"</span>, <span class="st">"member_casual"</span>)] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb36-124"><a href="#cb36-124" aria-hidden="true" tabindex="-1"></a>    dt[, <span class="fu">c</span>(<span class="st">"rideable_type"</span>, <span class="st">"member_casual"</span>)],</span>
<span id="cb36-125"><a href="#cb36-125" aria-hidden="true" tabindex="-1"></a>    as.factor</span>
<span id="cb36-126"><a href="#cb36-126" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-127"><a href="#cb36-127" aria-hidden="true" tabindex="-1"></a>  dt[[<span class="st">"year_month"</span>]] <span class="ot">&lt;-</span> <span class="fu">ordered</span>(dt[[<span class="st">"year_month"</span>]], <span class="at">levels =</span> <span class="fu">unique</span>(dt<span class="sc">$</span>year_month))</span>
<span id="cb36-128"><a href="#cb36-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(dt)</span>
<span id="cb36-129"><a href="#cb36-129" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-130"><a href="#cb36-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-131"><a href="#cb36-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-132"><a href="#cb36-132" aria-hidden="true" tabindex="-1"></a>get.raw_data <span class="ot">&lt;-</span> <span class="cf">function</span>(Url, <span class="at">Timeout =</span> <span class="dv">60</span>) {   <span class="do">## increase timeout if you get timeout error</span></span>
<span id="cb36-133"><a href="#cb36-133" aria-hidden="true" tabindex="-1"></a>  mm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"202106"</span>, <span class="st">"202107"</span>, <span class="st">"202108"</span>, <span class="st">"202109"</span>, <span class="st">"202110"</span>, <span class="st">"202111"</span>, <span class="st">"202112"</span>, <span class="st">"202201"</span>,</span>
<span id="cb36-134"><a href="#cb36-134" aria-hidden="true" tabindex="-1"></a>          <span class="st">"202202"</span>, <span class="st">"202203"</span>, <span class="st">"202204"</span>, <span class="st">"202205"</span>)</span>
<span id="cb36-135"><a href="#cb36-135" aria-hidden="true" tabindex="-1"></a>  url1 <span class="ot">&lt;-</span> Url</span>
<span id="cb36-136"><a href="#cb36-136" aria-hidden="true" tabindex="-1"></a>  urls <span class="ot">&lt;-</span> <span class="fu">lapply</span>(url1, paste, mm, <span class="st">"-divvy-tripdata.zip"</span>, <span class="at">sep =</span> <span class="st">""</span>)[[<span class="dv">1</span>]]</span>
<span id="cb36-137"><a href="#cb36-137" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-138"><a href="#cb36-138" aria-hidden="true" tabindex="-1"></a>  ls <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">length</span>(mm))</span>
<span id="cb36-139"><a href="#cb36-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(ls) <span class="ot">&lt;-</span> <span class="fu">paste</span>(mm, <span class="st">"-divvy-tripdata.csv"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb36-140"><a href="#cb36-140" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-141"><a href="#cb36-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">options</span>(<span class="at">timeout =</span> Timeout)</span>
<span id="cb36-142"><a href="#cb36-142" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ls)) {</span>
<span id="cb36-143"><a href="#cb36-143" aria-hidden="true" tabindex="-1"></a>    ls[[i]] <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">".zip"</span>)</span>
<span id="cb36-144"><a href="#cb36-144" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download.file</span>(urls[i], ls[[i]])</span>
<span id="cb36-145"><a href="#cb36-145" aria-hidden="true" tabindex="-1"></a>    ls[[i]] <span class="ot">&lt;-</span> <span class="fu">unzip</span>(ls[[i]], <span class="fu">names</span>(ls)[i], <span class="at">exdir =</span> <span class="fu">tempdir</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb36-146"><a href="#cb36-146" aria-hidden="true" tabindex="-1"></a>      data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="at">na.strings =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="cn">NA</span>))</span>
<span id="cb36-147"><a href="#cb36-147" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-148"><a href="#cb36-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">options</span>(<span class="at">timeout =</span> <span class="dv">60</span>)</span>
<span id="cb36-149"><a href="#cb36-149" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-150"><a href="#cb36-150" aria-hidden="true" tabindex="-1"></a>  raw.tot_data <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">rbindlist</span>(ls) <span class="sc">|&gt;</span> <span class="fu">add.cols</span>() <span class="sc">|&gt;</span> <span class="fu">change.datatypes</span>() <span class="sc">|&gt;</span> </span>
<span id="cb36-151"><a href="#cb36-151" aria-hidden="true" tabindex="-1"></a>    data.table<span class="sc">::</span><span class="fu">setcolorder</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">13</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">16</span>,<span class="dv">14</span>,<span class="dv">15</span>,<span class="dv">5</span><span class="sc">:</span><span class="dv">12</span>,<span class="dv">17</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb36-152"><a href="#cb36-152" aria-hidden="true" tabindex="-1"></a>    data.table<span class="sc">::</span><span class="fu">setkey</span>(ride_id)</span>
<span id="cb36-153"><a href="#cb36-153" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-154"><a href="#cb36-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(<span class="fu">gc</span>(<span class="at">reset =</span> T))</span>
<span id="cb36-155"><a href="#cb36-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(raw.tot_data)</span>
<span id="cb36-156"><a href="#cb36-156" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-157"><a href="#cb36-157" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-158"><a href="#cb36-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-159"><a href="#cb36-159" aria-hidden="true" tabindex="-1"></a>::: justify</span>
<span id="cb36-160"><a href="#cb36-160" aria-hidden="true" tabindex="-1"></a>We call the resulting dataset 'raw.tot_data'.</span>
<span id="cb36-161"><a href="#cb36-161" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-162"><a href="#cb36-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-163"><a href="#cb36-163" aria-hidden="true" tabindex="-1"></a><span class="in">```{r raw.tot_data}</span></span>
<span id="cb36-164"><a href="#cb36-164" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://divvy-tripdata.s3.amazonaws.com/"</span></span>
<span id="cb36-165"><a href="#cb36-165" aria-hidden="true" tabindex="-1"></a>raw.tot_data <span class="ot">&lt;-</span> <span class="fu">get.raw_data</span>(url, <span class="at">Timeout =</span> <span class="dv">5000</span>)</span>
<span id="cb36-166"><a href="#cb36-166" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-167"><a href="#cb36-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-168"><a href="#cb36-168" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="false"}</span>
<span id="cb36-169"><a href="#cb36-169" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb36-170"><a href="#cb36-170" aria-hidden="true" tabindex="-1"></a><span class="fu">## Note:</span></span>
<span id="cb36-171"><a href="#cb36-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-172"><a href="#cb36-172" aria-hidden="true" tabindex="-1"></a>The datasets are quite large (more then 5 million obs. total). If you wish to reproduce this analysis keep in mind it might take much time, even more than 1 hour with non recent hardware.</span>
<span id="cb36-173"><a href="#cb36-173" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-174"><a href="#cb36-174" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-175"><a href="#cb36-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-176"><a href="#cb36-176" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data cleansing</span></span>
<span id="cb36-177"><a href="#cb36-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-178"><a href="#cb36-178" aria-hidden="true" tabindex="-1"></a>::: justify</span>
<span id="cb36-179"><a href="#cb36-179" aria-hidden="true" tabindex="-1"></a>As next step we do some data cleansing. We must deal with missing and bad values, which the raw dataset has plenty of.</span>
<span id="cb36-180"><a href="#cb36-180" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-181"><a href="#cb36-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-182"><a href="#cb36-182" aria-hidden="true" tabindex="-1"></a><span class="in">```{r missing values}</span></span>
<span id="cb36-183"><a href="#cb36-183" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">miss_val =</span> <span class="fu">lapply</span>(raw.tot_data, is.na) <span class="sc">|&gt;</span> <span class="fu">lapply</span>(sum))</span>
<span id="cb36-184"><a href="#cb36-184" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-185"><a href="#cb36-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-186"><a href="#cb36-186" aria-hidden="true" tabindex="-1"></a>::: justify</span>
<span id="cb36-187"><a href="#cb36-187" aria-hidden="true" tabindex="-1"></a>We use two additional custom functions to accomplish this task.</span>
<span id="cb36-188"><a href="#cb36-188" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-189"><a href="#cb36-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-190"><a href="#cb36-190" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Data cleansing func}</span></span>
<span id="cb36-191"><a href="#cb36-191" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb36-192"><a href="#cb36-192" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Custom cleansing functions"</span></span>
<span id="cb36-193"><a href="#cb36-193" aria-hidden="true" tabindex="-1"></a>rm.outliers <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb36-194"><a href="#cb36-194" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span>(<span class="st">"data.table"</span> <span class="sc">%in%</span> <span class="fu">class</span>(data))) <span class="fu">stop</span>(<span class="st">"dt is not a data.table object."</span>)</span>
<span id="cb36-195"><a href="#cb36-195" aria-hidden="true" tabindex="-1"></a>  rl.upp_whisk <span class="ot">&lt;-</span> robustbase<span class="sc">::</span><span class="fu">adjboxStats</span>(data[ride_length <span class="sc">&gt;</span> <span class="dv">0</span>, ride_length])<span class="sc">$</span>stats[<span class="dv">5</span>]</span>
<span id="cb36-196"><a href="#cb36-196" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> data[<span class="sc">-</span><span class="fu">which</span>(ride_length <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> ride_length <span class="sc">&gt;</span> rl.upp_whisk</span>
<span id="cb36-197"><a href="#cb36-197" aria-hidden="true" tabindex="-1"></a>                    <span class="sc">|</span> (ride_dist <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> start_station_name <span class="sc">!=</span> end_station_name)</span>
<span id="cb36-198"><a href="#cb36-198" aria-hidden="true" tabindex="-1"></a>                    <span class="sc">|</span> (ride_dist <span class="sc">!=</span> <span class="dv">0</span> <span class="sc">&amp;</span> start_station_name <span class="sc">==</span> end_station_name)</span>
<span id="cb36-199"><a href="#cb36-199" aria-hidden="true" tabindex="-1"></a>                    <span class="sc">|</span> ride_dist <span class="sc">%in%</span> data[<span class="fu">order</span>(<span class="sc">-</span>ride_dist), <span class="fu">head</span>(.SD, <span class="dv">2</span>)]<span class="sc">$</span>ride_dist)]</span>
<span id="cb36-200"><a href="#cb36-200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb36-201"><a href="#cb36-201" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-202"><a href="#cb36-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-203"><a href="#cb36-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-204"><a href="#cb36-204" aria-hidden="true" tabindex="-1"></a>rm.missing <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb36-205"><a href="#cb36-205" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span>(<span class="st">"data.table"</span> <span class="sc">%in%</span> <span class="fu">class</span>(data))) <span class="fu">stop</span>(<span class="st">"dt is not a data.table object."</span>)</span>
<span id="cb36-206"><a href="#cb36-206" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> data[, <span class="fu">grep</span>(<span class="st">"*station"</span>, <span class="fu">names</span>(data)) <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb36-207"><a href="#cb36-207" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df[<span class="fu">complete.cases</span>(df)]</span>
<span id="cb36-208"><a href="#cb36-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb36-209"><a href="#cb36-209" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-210"><a href="#cb36-210" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-211"><a href="#cb36-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-212"><a href="#cb36-212" aria-hidden="true" tabindex="-1"></a>::: justify</span>
<span id="cb36-213"><a href="#cb36-213" aria-hidden="true" tabindex="-1"></a>This is what the two functions do:</span>
<span id="cb36-214"><a href="#cb36-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-215"><a href="#cb36-215" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Drop obs. with 'ride_length' <span class="sc">\&lt;</span> 0, since negative times don't make sense.</span>
<span id="cb36-216"><a href="#cb36-216" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Drop obs. with 'ride_length' <span class="sc">\&gt;</span> extreme of upper whisker of its boxplot adjusted for skewed distributions (see <span class="in">`robustbase::adjboxStats()`</span> documentation).</span>
<span id="cb36-217"><a href="#cb36-217" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Drop obs. with 'ride_dist' = 0, and 'start_station_name' != 'end_station_name', since null distance only makes sense when start station and end station are the same.</span>
<span id="cb36-218"><a href="#cb36-218" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Drop obs. with 'ride_dist' != 0, and 'start_station_name' = 'end_station_name'.</span>
<span id="cb36-219"><a href="#cb36-219" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Drop the two highest 'ride_dist' values, since max value is physically impossible, and the second highest one, while it might make sense in theory, is also an extremely far outlier compared to other values.</span>
<span id="cb36-220"><a href="#cb36-220" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Drop station IDs and names variables, since they have many non imputable values, and we won't use those variables in the following analysis.</span>
<span id="cb36-221"><a href="#cb36-221" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Drop rows with missing 'end_lat', 'end_lng' and 'ride_dist' values.</span>
<span id="cb36-222"><a href="#cb36-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-223"><a href="#cb36-223" aria-hidden="true" tabindex="-1"></a>::: callout-warning</span>
<span id="cb36-224"><a href="#cb36-224" aria-hidden="true" tabindex="-1"></a><span class="fu">## Warning!</span></span>
<span id="cb36-225"><a href="#cb36-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-226"><a href="#cb36-226" aria-hidden="true" tabindex="-1"></a>Arbitrarily removing observations from datasets is bad practice in real case scenarios, and might lead to strongly biased results. Always confront with your team and project stakeholders before removing any observation. However this is only a fictional case study, and this is the best we can do here.</span>
<span id="cb36-227"><a href="#cb36-227" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-228"><a href="#cb36-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-229"><a href="#cb36-229" aria-hidden="true" tabindex="-1"></a>We now run the two custom functions, and assign the output to 'tot_data'. This is the final dataset we'll use throughout the rest of the analysis. It has 5.673.722 rows and 13 columns.</span>
<span id="cb36-230"><a href="#cb36-230" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-231"><a href="#cb36-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-232"><a href="#cb36-232" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tot_data}</span></span>
<span id="cb36-233"><a href="#cb36-233" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb36-234"><a href="#cb36-234" aria-hidden="true" tabindex="-1"></a>tot_data <span class="ot">&lt;-</span> raw.tot_data <span class="sc">|&gt;</span> <span class="fu">rm.outliers</span>() <span class="sc">|&gt;</span> <span class="fu">rm.missing</span>()</span>
<span id="cb36-235"><a href="#cb36-235" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(tot_data)</span>
<span id="cb36-236"><a href="#cb36-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-237"><a href="#cb36-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-238"><a href="#cb36-238" aria-hidden="true" tabindex="-1"></a><span class="fu">## Explorative analysis</span></span>
<span id="cb36-239"><a href="#cb36-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-240"><a href="#cb36-240" aria-hidden="true" tabindex="-1"></a>::: justify</span>
<span id="cb36-241"><a href="#cb36-241" aria-hidden="true" tabindex="-1"></a>Next step is a brief exploratory analysis. We start by looking at 'ride_length' and 'ride_dist' distributions, with boxplots grouped by 'member_casual' variable, being the main variable of interest for this case study. Again, we use a custom function to draw the boxplots, and we apply a custom ggplot2 theme.</span>
<span id="cb36-242"><a href="#cb36-242" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-243"><a href="#cb36-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-244"><a href="#cb36-244" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Custom boxplot function}</span></span>
<span id="cb36-245"><a href="#cb36-245" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb36-246"><a href="#cb36-246" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Custom boxplot function"</span></span>
<span id="cb36-247"><a href="#cb36-247" aria-hidden="true" tabindex="-1"></a>box_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(data, x, y, <span class="at">mult=</span><span class="dv">1</span>, <span class="at">Fill =</span> <span class="st">"thistle2"</span>, <span class="at">outl.size =</span> <span class="fl">0.2</span>, <span class="at">Notch =</span> F, <span class="at">Coef =</span> <span class="fl">1.5</span>, </span>
<span id="cb36-248"><a href="#cb36-248" aria-hidden="true" tabindex="-1"></a>                     <span class="at">stat =</span> <span class="st">"mean"</span>, <span class="at">Breaks =</span> <span class="fu">waiver</span>(), <span class="at">Title =</span> <span class="st">"Title"</span>, <span class="at">Subtitle =</span> <span class="fu">waiver</span>(), </span>
<span id="cb36-249"><a href="#cb36-249" aria-hidden="true" tabindex="-1"></a>                     <span class="at">x.lab =</span> <span class="st">"x-axis label"</span>, <span class="at">y.lab =</span> <span class="st">"y-axis label"</span>) {</span>
<span id="cb36-250"><a href="#cb36-250" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-251"><a href="#cb36-251" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> <span class="fu">parse</span>(<span class="at">text =</span> x)</span>
<span id="cb36-252"><a href="#cb36-252" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">=</span> <span class="fu">parse</span>(<span class="at">text =</span> y)</span>
<span id="cb36-253"><a href="#cb36-253" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-254"><a href="#cb36-254" aria-hidden="true" tabindex="-1"></a>  box <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">eval</span>(x), <span class="at">y =</span> <span class="fu">eval</span>(y)<span class="sc">*</span>mult)) <span class="sc">+</span></span>
<span id="cb36-255"><a href="#cb36-255" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="at">outlier.size =</span> outl.size, <span class="at">fill =</span> Fill, <span class="at">notch =</span> Notch, <span class="at">coef =</span> Coef) <span class="sc">+</span></span>
<span id="cb36-256"><a href="#cb36-256" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_summary</span>(<span class="at">fun =</span> stat) <span class="sc">+</span></span>
<span id="cb36-257"><a href="#cb36-257" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> Breaks) <span class="sc">+</span></span>
<span id="cb36-258"><a href="#cb36-258" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(Title, Subtitle) <span class="sc">+</span></span>
<span id="cb36-259"><a href="#cb36-259" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(x.lab) <span class="sc">+</span></span>
<span id="cb36-260"><a href="#cb36-260" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(y.lab)</span>
<span id="cb36-261"><a href="#cb36-261" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-262"><a href="#cb36-262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(box)</span>
<span id="cb36-263"><a href="#cb36-263" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-264"><a href="#cb36-264" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-265"><a href="#cb36-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-266"><a href="#cb36-266" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Custom ggplot2 theme}</span></span>
<span id="cb36-267"><a href="#cb36-267" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb36-268"><a href="#cb36-268" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Custom ggplot2 theme"</span></span>
<span id="cb36-269"><a href="#cb36-269" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_update</span>(</span>
<span id="cb36-270"><a href="#cb36-270" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb36-271"><a href="#cb36-271" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb36-272"><a href="#cb36-272" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"grey85"</span>),</span>
<span id="cb36-273"><a href="#cb36-273" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb36-274"><a href="#cb36-274" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"whitesmoke"</span>),</span>
<span id="cb36-275"><a href="#cb36-275" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb36-276"><a href="#cb36-276" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb36-277"><a href="#cb36-277" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb36-278"><a href="#cb36-278" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"italic"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb36-279"><a href="#cb36-279" aria-hidden="true" tabindex="-1"></a>  <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"grey85"</span>),</span>
<span id="cb36-280"><a href="#cb36-280" aria-hidden="true" tabindex="-1"></a>  <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb36-281"><a href="#cb36-281" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb36-282"><a href="#cb36-282" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-283"><a href="#cb36-283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-284"><a href="#cb36-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-285"><a href="#cb36-285" aria-hidden="true" tabindex="-1"></a>::: justify</span>
<span id="cb36-286"><a href="#cb36-286" aria-hidden="true" tabindex="-1"></a>Below you can see the resulting plots:</span>
<span id="cb36-287"><a href="#cb36-287" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-288"><a href="#cb36-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-289"><a href="#cb36-289" aria-hidden="true" tabindex="-1"></a><span class="in">```{r boxplots}</span></span>
<span id="cb36-290"><a href="#cb36-290" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb36-291"><a href="#cb36-291" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: "90%"</span></span>
<span id="cb36-292"><a href="#cb36-292" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-height: "90%"</span></span>
<span id="cb36-293"><a href="#cb36-293" aria-hidden="true" tabindex="-1"></a>rl_box <span class="ot">&lt;-</span> <span class="fu">box_plot</span>(tot_data, <span class="st">"member_casual"</span>, <span class="st">"ride_length"</span>, <span class="at">mult =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">60</span>,</span>
<span id="cb36-294"><a href="#cb36-294" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Fill =</span>  viridisLite<span class="sc">::</span><span class="fu">turbo</span>(<span class="dv">25</span>)[<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">16</span>)], <span class="at">Notch =</span> T, <span class="at">Breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">90</span>,<span class="dv">5</span>), </span>
<span id="cb36-295"><a href="#cb36-295" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Title =</span> <span class="st">"Ride length boxplots"</span>, <span class="at">x.lab =</span> <span class="st">"Membership"</span>,</span>
<span id="cb36-296"><a href="#cb36-296" aria-hidden="true" tabindex="-1"></a>                        <span class="at">y.lab =</span> <span class="st">"Ride length (min.)"</span>)</span>
<span id="cb36-297"><a href="#cb36-297" aria-hidden="true" tabindex="-1"></a>rd_box <span class="ot">&lt;-</span> <span class="fu">box_plot</span>(tot_data, <span class="st">"member_casual"</span>, <span class="st">"ride_dist"</span>, <span class="at">mult =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb36-298"><a href="#cb36-298" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Fill =</span>  viridisLite<span class="sc">::</span><span class="fu">turbo</span>(<span class="dv">25</span>)[<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">16</span>)], <span class="at">Notch =</span> T, <span class="at">Breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">35</span>,<span class="fl">2.5</span>), </span>
<span id="cb36-299"><a href="#cb36-299" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Title =</span> <span class="st">"Ride dist boxplots"</span>, <span class="at">x.lab =</span> <span class="st">"Membership"</span>, </span>
<span id="cb36-300"><a href="#cb36-300" aria-hidden="true" tabindex="-1"></a>                        <span class="at">y.lab =</span> <span class="st">"Ride distance (km)"</span>)</span>
<span id="cb36-301"><a href="#cb36-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-302"><a href="#cb36-302" aria-hidden="true" tabindex="-1"></a>rl_box <span class="sc">+</span> rd_box <span class="co"># patchwork composition</span></span>
<span id="cb36-303"><a href="#cb36-303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-304"><a href="#cb36-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-305"><a href="#cb36-305" aria-hidden="true" tabindex="-1"></a>::: justify</span>
<span id="cb36-306"><a href="#cb36-306" aria-hidden="true" tabindex="-1"></a>All the four distributions are heavily right skewed, with mean (black dot) <span class="sc">\&gt;</span> median, long upper whiskers and many outliers on the upper side.</span>
<span id="cb36-307"><a href="#cb36-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-308"><a href="#cb36-308" aria-hidden="true" tabindex="-1"></a>Looking at 'ride_length' plot, we notice casuals group has higher variance than members one, since casuals box is wider. Also, all casuals boxplot statistics have higher values than their members counterparts. Hence it seems like casual customers have a tendency to take longer rides, and more diverse use cases for Cyclistic's bikes. Conversely, the two 'ride_dist' boxplots look very similar, suggesting the two groups cover the same distance on average. Additional more formal analysis is required here in order to draw conclusions. This preliminar graphical analysis suggests members are more likely to use Cyclistic's bikes for daily routine tasks, like commuting to work, compared to casual customers who occasionally rent them for leisure. Moreover, from the boxplots results, it's clear that the current Cyclistic strategy doesn't profit from 'ride_length', since members, being the most profitable group, take shorter rides.</span>
<span id="cb36-309"><a href="#cb36-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-310"><a href="#cb36-310" aria-hidden="true" tabindex="-1"></a>As next step we compute some summary statistics for 'ride_length' and 'rideable_type' variables. We'll use them later to draw additional visualizations. Again we write a custom function to do it, in order to save keystrokes.</span>
<span id="cb36-311"><a href="#cb36-311" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-312"><a href="#cb36-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-313"><a href="#cb36-313" aria-hidden="true" tabindex="-1"></a><span class="in">```{r custom summary function}</span></span>
<span id="cb36-314"><a href="#cb36-314" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb36-315"><a href="#cb36-315" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Custom summary function"</span></span>
<span id="cb36-316"><a href="#cb36-316" aria-hidden="true" tabindex="-1"></a>Summ <span class="ot">&lt;-</span> <span class="cf">function</span>(data, var, group_by, <span class="at">order_by =</span> group_by) {</span>
<span id="cb36-317"><a href="#cb36-317" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span>(<span class="st">"data.table"</span> <span class="sc">%in%</span> <span class="fu">class</span>(data))) <span class="fu">stop</span>(<span class="st">"dt is not a data.table object."</span>)</span>
<span id="cb36-318"><a href="#cb36-318" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-319"><a href="#cb36-319" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> <span class="fu">parse</span>(<span class="at">text =</span> var)</span>
<span id="cb36-320"><a href="#cb36-320" aria-hidden="true" tabindex="-1"></a>  summ <span class="ot">=</span> data[</span>
<span id="cb36-321"><a href="#cb36-321" aria-hidden="true" tabindex="-1"></a>    ,</span>
<span id="cb36-322"><a href="#cb36-322" aria-hidden="true" tabindex="-1"></a>    .(<span class="at">obs =</span> <span class="fu">NROW</span>(<span class="fu">eval</span>(x)), <span class="at">quart1 =</span> <span class="fu">quantile</span>(<span class="fu">eval</span>(x), <span class="fl">0.25</span>), <span class="at">mean =</span> <span class="fu">mean</span>(<span class="fu">eval</span>(x)), </span>
<span id="cb36-323"><a href="#cb36-323" aria-hidden="true" tabindex="-1"></a>      <span class="at">median =</span> <span class="fu">median</span>(<span class="fu">eval</span>(x)), <span class="at">quart3 =</span> <span class="fu">quantile</span>(<span class="fu">eval</span>(x), <span class="fl">0.75</span>), <span class="at">iqr =</span> <span class="fu">IQR</span>(<span class="fu">eval</span>(x)),</span>
<span id="cb36-324"><a href="#cb36-324" aria-hidden="true" tabindex="-1"></a>      <span class="at">stdev =</span> <span class="fu">sd</span>(<span class="fu">eval</span>(x))), </span>
<span id="cb36-325"><a href="#cb36-325" aria-hidden="true" tabindex="-1"></a>    by <span class="ot">=</span> group_by</span>
<span id="cb36-326"><a href="#cb36-326" aria-hidden="true" tabindex="-1"></a>  ] <span class="sc">|&gt;</span> data.table<span class="sc">::</span><span class="fu">setorderv</span>(<span class="at">cols =</span> order_by)</span>
<span id="cb36-327"><a href="#cb36-327" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-328"><a href="#cb36-328" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(summ)</span>
<span id="cb36-329"><a href="#cb36-329" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-330"><a href="#cb36-330" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-331"><a href="#cb36-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-332"><a href="#cb36-332" aria-hidden="true" tabindex="-1"></a><span class="in">```{r summaries}</span></span>
<span id="cb36-333"><a href="#cb36-333" aria-hidden="true" tabindex="-1"></a>rl_summ_by_ym <span class="ot">&lt;-</span> <span class="fu">Summ</span>(tot_data, <span class="st">"ride_length"</span>, <span class="fu">c</span>(<span class="st">"member_casual"</span>, <span class="st">"year_month"</span>))</span>
<span id="cb36-334"><a href="#cb36-334" aria-hidden="true" tabindex="-1"></a>rl_summ_by_wd <span class="ot">&lt;-</span> <span class="fu">Summ</span>(tot_data, <span class="st">"ride_length"</span>, <span class="fu">c</span>(<span class="st">"member_casual"</span>, <span class="st">"weekday"</span>))</span>
<span id="cb36-335"><a href="#cb36-335" aria-hidden="true" tabindex="-1"></a>rt_summ <span class="ot">&lt;-</span> tot_data[, .(<span class="at">obs =</span> .N), by <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"member_casual"</span>, <span class="st">"rideable_type"</span>)]</span>
<span id="cb36-336"><a href="#cb36-336" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-337"><a href="#cb36-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-338"><a href="#cb36-338" aria-hidden="true" tabindex="-1"></a>::: {#summaries .panel-tabset}</span>
<span id="cb36-339"><a href="#cb36-339" aria-hidden="true" tabindex="-1"></a><span class="fu">## rl_summ_by_ym</span></span>
<span id="cb36-340"><a href="#cb36-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-343"><a href="#cb36-343" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-344"><a href="#cb36-344" aria-hidden="true" tabindex="-1"></a>rl_summ_by_ym</span>
<span id="cb36-345"><a href="#cb36-345" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-346"><a href="#cb36-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-347"><a href="#cb36-347" aria-hidden="true" tabindex="-1"></a><span class="fu">## rl_summ_by_wd</span></span>
<span id="cb36-348"><a href="#cb36-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-351"><a href="#cb36-351" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-352"><a href="#cb36-352" aria-hidden="true" tabindex="-1"></a>rl_summ_by_wd</span>
<span id="cb36-353"><a href="#cb36-353" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-354"><a href="#cb36-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-355"><a href="#cb36-355" aria-hidden="true" tabindex="-1"></a><span class="fu">## rt_summ</span></span>
<span id="cb36-356"><a href="#cb36-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-359"><a href="#cb36-359" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-360"><a href="#cb36-360" aria-hidden="true" tabindex="-1"></a>rt_summ</span>
<span id="cb36-361"><a href="#cb36-361" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-362"><a href="#cb36-362" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-363"><a href="#cb36-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-364"><a href="#cb36-364" aria-hidden="true" tabindex="-1"></a>::: justify</span>
<span id="cb36-365"><a href="#cb36-365" aria-hidden="true" tabindex="-1"></a>As final step of our exploratory data analysis, we perform Welch's t-tests on 'ride_length' and 'ride_dist' variables means, with 'member_casual' being the grouping factor. We also compute Cohen's D estimates to see the actual effect size of 'member_casual' on the other two variables.</span>
<span id="cb36-366"><a href="#cb36-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-367"><a href="#cb36-367" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="False"}</span>
<span id="cb36-368"><a href="#cb36-368" aria-hidden="true" tabindex="-1"></a><span class="fu">## Note:</span></span>
<span id="cb36-369"><a href="#cb36-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-370"><a href="#cb36-370" aria-hidden="true" tabindex="-1"></a>Since we have a very large dataset, Welch's tests will almost certainly reject the null hypothesis of equal population means for member and casual customers. That's why we also estimate the actual effect sizes of 'member_casual' variable with Cohen's d statistics.</span>
<span id="cb36-371"><a href="#cb36-371" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-372"><a href="#cb36-372" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-373"><a href="#cb36-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-374"><a href="#cb36-374" aria-hidden="true" tabindex="-1"></a><span class="in">```{r welch t-tests}</span></span>
<span id="cb36-375"><a href="#cb36-375" aria-hidden="true" tabindex="-1"></a>welch_rl <span class="ot">&lt;-</span> <span class="fu">t.test</span>(ride_length <span class="sc">~</span> member_casual, <span class="at">data =</span> tot_data)</span>
<span id="cb36-376"><a href="#cb36-376" aria-hidden="true" tabindex="-1"></a>welch_rd <span class="ot">&lt;-</span> <span class="fu">t.test</span>(ride_dist <span class="sc">~</span> member_casual, <span class="at">data =</span> tot_data)</span>
<span id="cb36-377"><a href="#cb36-377" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-378"><a href="#cb36-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-379"><a href="#cb36-379" aria-hidden="true" tabindex="-1"></a>::: {#welch .panel-tabset}</span>
<span id="cb36-380"><a href="#cb36-380" aria-hidden="true" tabindex="-1"></a><span class="fu">## welch_rl</span></span>
<span id="cb36-381"><a href="#cb36-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-384"><a href="#cb36-384" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-385"><a href="#cb36-385" aria-hidden="true" tabindex="-1"></a>welch_rl</span>
<span id="cb36-386"><a href="#cb36-386" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-387"><a href="#cb36-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-388"><a href="#cb36-388" aria-hidden="true" tabindex="-1"></a><span class="fu">## welch_rd</span></span>
<span id="cb36-389"><a href="#cb36-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-392"><a href="#cb36-392" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-393"><a href="#cb36-393" aria-hidden="true" tabindex="-1"></a>welch_rd</span>
<span id="cb36-394"><a href="#cb36-394" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-395"><a href="#cb36-395" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-396"><a href="#cb36-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-397"><a href="#cb36-397" aria-hidden="true" tabindex="-1"></a>::: justify</span>
<span id="cb36-398"><a href="#cb36-398" aria-hidden="true" tabindex="-1"></a>As expected, both tests reject the null hypothesis of equal population means. So let's see how strong the relationships between 'member_casuals', and 'ride_dist' and 'ride_length' variables actually are. Relying on the two boxplots, we can assume a moderate to high effect size on 'ride_length' variable, and a small effect size on 'ride_dist' variable.</span>
<span id="cb36-399"><a href="#cb36-399" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-400"><a href="#cb36-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-401"><a href="#cb36-401" aria-hidden="true" tabindex="-1"></a><span class="in">```{r cohens D estimates}</span></span>
<span id="cb36-402"><a href="#cb36-402" aria-hidden="true" tabindex="-1"></a>cohensD_rl <span class="ot">&lt;-</span> rstatix<span class="sc">::</span><span class="fu">cohens_d</span>(ride_length <span class="sc">~</span> member_casual, <span class="at">data =</span> tot_data)</span>
<span id="cb36-403"><a href="#cb36-403" aria-hidden="true" tabindex="-1"></a>cohensD_rd <span class="ot">&lt;-</span> rstatix<span class="sc">::</span><span class="fu">cohens_d</span>(ride_dist <span class="sc">~</span> member_casual, <span class="at">data =</span> tot_data)</span>
<span id="cb36-404"><a href="#cb36-404" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-405"><a href="#cb36-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-406"><a href="#cb36-406" aria-hidden="true" tabindex="-1"></a>::: {#cohensD .panel-tabset}</span>
<span id="cb36-407"><a href="#cb36-407" aria-hidden="true" tabindex="-1"></a><span class="fu">## cohensD_rl</span></span>
<span id="cb36-408"><a href="#cb36-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-411"><a href="#cb36-411" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-412"><a href="#cb36-412" aria-hidden="true" tabindex="-1"></a>cohensD_rl</span>
<span id="cb36-413"><a href="#cb36-413" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-414"><a href="#cb36-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-415"><a href="#cb36-415" aria-hidden="true" tabindex="-1"></a><span class="fu">## cohensD_rd</span></span>
<span id="cb36-416"><a href="#cb36-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-419"><a href="#cb36-419" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-420"><a href="#cb36-420" aria-hidden="true" tabindex="-1"></a>cohensD_rd</span>
<span id="cb36-421"><a href="#cb36-421" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-422"><a href="#cb36-422" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-423"><a href="#cb36-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-424"><a href="#cb36-424" aria-hidden="true" tabindex="-1"></a>::: justify</span>
<span id="cb36-425"><a href="#cb36-425" aria-hidden="true" tabindex="-1"></a>As expected, our assumptions about effect sizes turned out correct. 'member_casual' has a moderate effect size on 'ride_length' variable, and a negligible effect on 'ride_dist'. That's more evidence supporting our previous findings about the two types of customers: casuals tend to take significantly longer rides and are more likely to use Cyclistic bikes for leisure.</span>
<span id="cb36-426"><a href="#cb36-426" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-427"><a href="#cb36-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-428"><a href="#cb36-428" aria-hidden="true" tabindex="-1"></a><span class="fu">## Visualizations</span></span>
<span id="cb36-429"><a href="#cb36-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-430"><a href="#cb36-430" aria-hidden="true" tabindex="-1"></a>::: justify</span>
<span id="cb36-431"><a href="#cb36-431" aria-hidden="true" tabindex="-1"></a>Last step of our analysis consists of some additional visualizations about the total number of rides, and some maps.</span>
<span id="cb36-432"><a href="#cb36-432" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-433"><a href="#cb36-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-434"><a href="#cb36-434" aria-hidden="true" tabindex="-1"></a><span class="in">```{r custom viz functions}</span></span>
<span id="cb36-435"><a href="#cb36-435" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb36-436"><a href="#cb36-436" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Custom visualiz. functions"</span></span>
<span id="cb36-437"><a href="#cb36-437" aria-hidden="true" tabindex="-1"></a>col_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(data, x, y, group, <span class="at">mult =</span> <span class="dv">1</span>, <span class="at">Legend =</span> F, <span class="at">text_vjust =</span> <span class="dv">0</span>, <span class="at">text_col =</span> <span class="st">"black"</span>, </span>
<span id="cb36-438"><a href="#cb36-438" aria-hidden="true" tabindex="-1"></a>                     <span class="at">text_fface =</span> <span class="st">"bold"</span>, <span class="at">text.size =</span> <span class="fl">2.5</span>, <span class="at">facet_nrow =</span> <span class="dv">2</span>, <span class="at">facet_strip =</span> <span class="st">"right"</span>, </span>
<span id="cb36-439"><a href="#cb36-439" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Breaks =</span> <span class="fu">waiver</span>(), <span class="at">col_man =</span> <span class="fu">rep</span>(<span class="st">"black"</span>, facet_nrow), </span>
<span id="cb36-440"><a href="#cb36-440" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Fill_man =</span> <span class="fu">rep</span>(<span class="st">"thistle2"</span>, facet_nrow), <span class="at">Title =</span> <span class="st">"Title"</span>, <span class="at">Subtitle =</span> <span class="fu">waiver</span>(), </span>
<span id="cb36-441"><a href="#cb36-441" aria-hidden="true" tabindex="-1"></a>                     <span class="at">x.lab =</span> <span class="st">"x-axis label"</span>, <span class="at">y.lab =</span> <span class="st">"y-axis label"</span>, <span class="at">Round =</span> <span class="dv">2</span>, <span class="at">Angle =</span> <span class="dv">0</span>) {</span>
<span id="cb36-442"><a href="#cb36-442" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> <span class="fu">parse</span>(<span class="at">text =</span> x)</span>
<span id="cb36-443"><a href="#cb36-443" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">=</span> <span class="fu">parse</span>(<span class="at">text =</span> y)</span>
<span id="cb36-444"><a href="#cb36-444" aria-hidden="true" tabindex="-1"></a>  group <span class="ot">=</span> <span class="fu">parse</span>(<span class="at">text =</span> group)</span>
<span id="cb36-445"><a href="#cb36-445" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-446"><a href="#cb36-446" aria-hidden="true" tabindex="-1"></a>  col <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">eval</span>(x), <span class="at">y =</span> <span class="fu">eval</span>(y)<span class="sc">*</span>mult)) <span class="sc">+</span></span>
<span id="cb36-447"><a href="#cb36-447" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">eval</span>(group), <span class="at">fill =</span> <span class="fu">eval</span>(group)), <span class="at">show.legend =</span> Legend) <span class="sc">+</span></span>
<span id="cb36-448"><a href="#cb36-448" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(<span class="fu">eval</span>(y)<span class="sc">*</span>mult, Round)), </span>
<span id="cb36-449"><a href="#cb36-449" aria-hidden="true" tabindex="-1"></a>              <span class="at">vjust =</span> text_vjust, </span>
<span id="cb36-450"><a href="#cb36-450" aria-hidden="true" tabindex="-1"></a>              <span class="at">colour =</span> text_col, </span>
<span id="cb36-451"><a href="#cb36-451" aria-hidden="true" tabindex="-1"></a>              <span class="at">fontface =</span> text_fface, </span>
<span id="cb36-452"><a href="#cb36-452" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> text.size) <span class="sc">+</span></span>
<span id="cb36-453"><a href="#cb36-453" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span><span class="fu">eval</span>(group), <span class="at">nrow =</span> facet_nrow, <span class="at">strip.position =</span> facet_strip) <span class="sc">+</span></span>
<span id="cb36-454"><a href="#cb36-454" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> Breaks) <span class="sc">+</span></span>
<span id="cb36-455"><a href="#cb36-455" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> col_man) <span class="sc">+</span></span>
<span id="cb36-456"><a href="#cb36-456" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> Fill_man) <span class="sc">+</span></span>
<span id="cb36-457"><a href="#cb36-457" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> Angle)) <span class="sc">+</span></span>
<span id="cb36-458"><a href="#cb36-458" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(Title, Subtitle) <span class="sc">+</span></span>
<span id="cb36-459"><a href="#cb36-459" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(x.lab) <span class="sc">+</span></span>
<span id="cb36-460"><a href="#cb36-460" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(y.lab)</span>
<span id="cb36-461"><a href="#cb36-461" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-462"><a href="#cb36-462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(col)</span>
<span id="cb36-463"><a href="#cb36-463" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-464"><a href="#cb36-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-465"><a href="#cb36-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-466"><a href="#cb36-466" aria-hidden="true" tabindex="-1"></a>map_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(data, lng, lat, group, <span class="at">Zoom =</span> <span class="dv">11</span>, <span class="at">Crop =</span> F, <span class="at">Type =</span> <span class="st">"toner-lite"</span>, <span class="at">transp =</span> <span class="fl">0.05</span>,</span>
<span id="cb36-467"><a href="#cb36-467" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dot.size =</span> <span class="fl">0.85</span>, <span class="at">col_man =</span> <span class="st">"black"</span>, <span class="at">fill_man =</span> <span class="st">"black"</span>, <span class="at">x.lab =</span> <span class="st">"longitude"</span>,</span>
<span id="cb36-468"><a href="#cb36-468" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y.lab =</span> <span class="st">"latitude"</span>, <span class="at">Title =</span> <span class="st">"map"</span>) {</span>
<span id="cb36-469"><a href="#cb36-469" aria-hidden="true" tabindex="-1"></a>  lng <span class="ot">=</span> <span class="fu">parse</span>(<span class="at">text =</span> lng)</span>
<span id="cb36-470"><a href="#cb36-470" aria-hidden="true" tabindex="-1"></a>  lat <span class="ot">=</span> <span class="fu">parse</span>(<span class="at">text =</span> lat)</span>
<span id="cb36-471"><a href="#cb36-471" aria-hidden="true" tabindex="-1"></a>  group <span class="ot">=</span> <span class="fu">parse</span>(<span class="at">text =</span> group)</span>
<span id="cb36-472"><a href="#cb36-472" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-473"><a href="#cb36-473" aria-hidden="true" tabindex="-1"></a>  map.lim <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">min</span>(data[, <span class="fu">eval</span>(lng)]), <span class="fu">min</span>(data[, <span class="fu">eval</span>(lat)]), </span>
<span id="cb36-474"><a href="#cb36-474" aria-hidden="true" tabindex="-1"></a>              <span class="fu">max</span>(data[, <span class="fu">eval</span>(lng)]), <span class="fu">max</span>(data[, <span class="fu">eval</span>(lat)]))</span>
<span id="cb36-475"><a href="#cb36-475" aria-hidden="true" tabindex="-1"></a>  map <span class="ot">=</span> <span class="fu">get_stamenmap</span>(<span class="at">bbox =</span> map.lim, <span class="at">zoom =</span> Zoom, <span class="at">maptype =</span> Type, <span class="at">crop =</span> Crop)</span>
<span id="cb36-476"><a href="#cb36-476" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-477"><a href="#cb36-477" aria-hidden="true" tabindex="-1"></a>  map.plot <span class="ot">&lt;-</span> ggmap<span class="sc">::</span><span class="fu">ggmap</span>(map) <span class="sc">+</span></span>
<span id="cb36-478"><a href="#cb36-478" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> data, </span>
<span id="cb36-479"><a href="#cb36-479" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">eval</span>(lng), <span class="at">y =</span> <span class="fu">eval</span>(lat), <span class="at">fill =</span> <span class="fu">eval</span>(group), <span class="at">colour =</span> <span class="fu">eval</span>(group)),</span>
<span id="cb36-480"><a href="#cb36-480" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> transp, <span class="at">size =</span> dot.size) <span class="sc">+</span></span>
<span id="cb36-481"><a href="#cb36-481" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> col_man) <span class="sc">+</span></span>
<span id="cb36-482"><a href="#cb36-482" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> fill_man) <span class="sc">+</span></span>
<span id="cb36-483"><a href="#cb36-483" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">1.5</span>))) <span class="sc">+</span></span>
<span id="cb36-484"><a href="#cb36-484" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>(), <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.80</span>, <span class="fl">0.90</span>),</span>
<span id="cb36-485"><a href="#cb36-485" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb36-486"><a href="#cb36-486" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(x.lab) <span class="sc">+</span></span>
<span id="cb36-487"><a href="#cb36-487" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(y.lab) <span class="sc">+</span></span>
<span id="cb36-488"><a href="#cb36-488" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="at">label =</span> Title)</span>
<span id="cb36-489"><a href="#cb36-489" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-490"><a href="#cb36-490" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(map.plot)</span>
<span id="cb36-491"><a href="#cb36-491" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-492"><a href="#cb36-492" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-493"><a href="#cb36-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-494"><a href="#cb36-494" aria-hidden="true" tabindex="-1"></a>::: justify</span>
<span id="cb36-495"><a href="#cb36-495" aria-hidden="true" tabindex="-1"></a>Below you can look at column plots for number of rides by month and by day of week, both grouped by 'member_casual'.</span>
<span id="cb36-496"><a href="#cb36-496" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-497"><a href="#cb36-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-498"><a href="#cb36-498" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ride_length colplots}</span></span>
<span id="cb36-499"><a href="#cb36-499" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb36-500"><a href="#cb36-500" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: "90%"</span></span>
<span id="cb36-501"><a href="#cb36-501" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-height: "90%"</span></span>
<span id="cb36-502"><a href="#cb36-502" aria-hidden="true" tabindex="-1"></a>nr.ym <span class="ot">&lt;-</span> <span class="fu">col_plot</span>(rl_summ_by_ym, <span class="st">"year_month"</span>, <span class="st">"obs"</span>, <span class="st">"member_casual"</span>, <span class="at">mult =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb36-503"><a href="#cb36-503" aria-hidden="true" tabindex="-1"></a>                       <span class="at">text_vjust =</span> <span class="fl">1.2</span>, <span class="at">Breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">500</span>, <span class="dv">50</span>), <span class="at">Title =</span> <span class="st">"Num. rides by month"</span>,</span>
<span id="cb36-504"><a href="#cb36-504" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Fill_man =</span> viridisLite<span class="sc">::</span><span class="fu">turbo</span>(<span class="dv">25</span>)[<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">16</span>)], <span class="at">x.lab =</span> <span class="st">"Month"</span>,</span>
<span id="cb36-505"><a href="#cb36-505" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y.lab =</span> <span class="st">"Num. rides (thousands)"</span>, <span class="at">Round =</span> <span class="dv">0</span>, <span class="at">Angle =</span> <span class="dv">90</span>)</span>
<span id="cb36-506"><a href="#cb36-506" aria-hidden="true" tabindex="-1"></a>nr.wd <span class="ot">&lt;-</span> <span class="fu">col_plot</span>(rl_summ_by_wd, <span class="st">"weekday"</span>, <span class="st">"obs"</span>, <span class="st">"member_casual"</span>, <span class="at">mult =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb36-507"><a href="#cb36-507" aria-hidden="true" tabindex="-1"></a>                       <span class="at">text_vjust =</span> <span class="dv">5</span>, <span class="at">Breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">500</span>, <span class="dv">50</span>), <span class="at">Title =</span> <span class="st">"Num. rides by weekday"</span>,</span>
<span id="cb36-508"><a href="#cb36-508" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Fill_man =</span> viridisLite<span class="sc">::</span><span class="fu">turbo</span>(<span class="dv">25</span>)[<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">16</span>)], <span class="at">x.lab =</span> <span class="st">"Weekday"</span>,</span>
<span id="cb36-509"><a href="#cb36-509" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y.lab =</span> <span class="st">"Num. rides (thousands)"</span>, <span class="at">Round =</span> <span class="dv">0</span>)</span>
<span id="cb36-510"><a href="#cb36-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-511"><a href="#cb36-511" aria-hidden="true" tabindex="-1"></a>nr.ym <span class="sc">+</span> nr.wd <span class="co">#patchwork composition</span></span>
<span id="cb36-512"><a href="#cb36-512" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-513"><a href="#cb36-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-514"><a href="#cb36-514" aria-hidden="true" tabindex="-1"></a>::: justify</span>
<span id="cb36-515"><a href="#cb36-515" aria-hidden="true" tabindex="-1"></a>These plots are quite interesting. The first one shows an obvious decline of the number of rides in cold seasons, for both casual and member customers, but the decline is steeper for casual riders. The second plot shows plain different trends in the number of rides by day of week: casuals do ride more during the weekend, while members have an opposite trend, with maximum number of rides during mid-week, and a decline towards the weekend. Those are pretty strong evidences that annual members mostly use Cyclistic bike sharing service to commute to work, while casuals rent bikes for leisure, mainly.</span>
<span id="cb36-516"><a href="#cb36-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-517"><a href="#cb36-517" aria-hidden="true" tabindex="-1"></a>With the following column plot we also take a look at customers preferences about bike types.</span>
<span id="cb36-518"><a href="#cb36-518" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-519"><a href="#cb36-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-520"><a href="#cb36-520" aria-hidden="true" tabindex="-1"></a><span class="in">```{r bike type colplot}</span></span>
<span id="cb36-521"><a href="#cb36-521" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb36-522"><a href="#cb36-522" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: "90%"</span></span>
<span id="cb36-523"><a href="#cb36-523" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-height: "90%"</span></span>
<span id="cb36-524"><a href="#cb36-524" aria-hidden="true" tabindex="-1"></a>nr.rt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(rt_summ, <span class="fu">aes</span>(<span class="at">x =</span> rideable_type, <span class="at">y =</span> obs<span class="sc">/</span><span class="dv">1000</span>)) <span class="sc">+</span></span>
<span id="cb36-525"><a href="#cb36-525" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> member_casual), <span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb36-526"><a href="#cb36-526" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(</span>
<span id="cb36-527"><a href="#cb36-527" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">group =</span> member_casual, <span class="at">label =</span> <span class="fu">round</span>(obs<span class="sc">/</span><span class="dv">1000</span>)), </span>
<span id="cb36-528"><a href="#cb36-528" aria-hidden="true" tabindex="-1"></a>      <span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="at">width =</span> <span class="dv">1</span>),</span>
<span id="cb36-529"><a href="#cb36-529" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="dv">2</span>, <span class="at">fontface =</span> <span class="st">"bold"</span></span>
<span id="cb36-530"><a href="#cb36-530" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb36-531"><a href="#cb36-531" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> viridisLite<span class="sc">::</span><span class="fu">turbo</span>(<span class="dv">25</span>)[<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">16</span>)]) <span class="sc">+</span></span>
<span id="cb36-532"><a href="#cb36-532" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">85</span>, .<span class="dv">85</span>), <span class="at">legend.title =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb36-533"><a href="#cb36-533" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Num. rides (thousands)"</span>) <span class="sc">+</span></span>
<span id="cb36-534"><a href="#cb36-534" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Bike type"</span>) <span class="sc">+</span> </span>
<span id="cb36-535"><a href="#cb36-535" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Num. rides by bike type"</span>)</span>
<span id="cb36-536"><a href="#cb36-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-537"><a href="#cb36-537" aria-hidden="true" tabindex="-1"></a>nr.rt</span>
<span id="cb36-538"><a href="#cb36-538" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-539"><a href="#cb36-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-540"><a href="#cb36-540" aria-hidden="true" tabindex="-1"></a>::: justify</span>
<span id="cb36-541"><a href="#cb36-541" aria-hidden="true" tabindex="-1"></a>As we can see, docked bikes ar by far the least popular category, and more important, those are only used by casual customers. It makes sense in accordance to previous findings, that annual members prefer the flexibility of non-docked bikes when commuting to work.</span>
<span id="cb36-542"><a href="#cb36-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-543"><a href="#cb36-543" aria-hidden="true" tabindex="-1"></a>Eventually, we draw two maps paired with scatterplots of start and end coordinates.</span>
<span id="cb36-544"><a href="#cb36-544" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-545"><a href="#cb36-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-546"><a href="#cb36-546" aria-hidden="true" tabindex="-1"></a><span class="in">```{r maps}</span></span>
<span id="cb36-547"><a href="#cb36-547" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb36-548"><a href="#cb36-548" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: "90%"</span></span>
<span id="cb36-549"><a href="#cb36-549" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-height: "90%"</span></span>
<span id="cb36-550"><a href="#cb36-550" aria-hidden="true" tabindex="-1"></a>start_map <span class="ot">&lt;-</span> <span class="fu">map_plot</span>(tot_data, <span class="st">"start_lng"</span>, <span class="st">"start_lat"</span>, <span class="st">"member_casual"</span>,</span>
<span id="cb36-551"><a href="#cb36-551" aria-hidden="true" tabindex="-1"></a>                           <span class="at">col_man =</span> viridisLite<span class="sc">::</span><span class="fu">turbo</span>(<span class="dv">25</span>)[<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">16</span>)], </span>
<span id="cb36-552"><a href="#cb36-552" aria-hidden="true" tabindex="-1"></a>                           <span class="at">fill_man =</span> viridisLite<span class="sc">::</span><span class="fu">turbo</span>(<span class="dv">25</span>)[<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">16</span>)], <span class="at">Title =</span> <span class="st">"Start map"</span>)</span>
<span id="cb36-553"><a href="#cb36-553" aria-hidden="true" tabindex="-1"></a>end_map <span class="ot">&lt;-</span> <span class="fu">map_plot</span>(tot_data, <span class="st">"end_lng"</span>, <span class="st">"end_lat"</span>, <span class="st">"member_casual"</span>,</span>
<span id="cb36-554"><a href="#cb36-554" aria-hidden="true" tabindex="-1"></a>                         <span class="at">col_man =</span> viridisLite<span class="sc">::</span><span class="fu">turbo</span>(<span class="dv">25</span>)[<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">16</span>)], </span>
<span id="cb36-555"><a href="#cb36-555" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fill_man =</span> viridisLite<span class="sc">::</span><span class="fu">turbo</span>(<span class="dv">25</span>)[<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">16</span>)], <span class="at">Title =</span> <span class="st">"End map"</span>)</span>
<span id="cb36-556"><a href="#cb36-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-557"><a href="#cb36-557" aria-hidden="true" tabindex="-1"></a>start_map <span class="sc">+</span> end_map <span class="co">#patchwork composition</span></span>
<span id="cb36-558"><a href="#cb36-558" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-559"><a href="#cb36-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-560"><a href="#cb36-560" aria-hidden="true" tabindex="-1"></a>::: justify</span>
<span id="cb36-561"><a href="#cb36-561" aria-hidden="true" tabindex="-1"></a>The two maps clearly show that member customers are Chicago locals mainly, while casuals are more dispersed and more likely to be tourists.</span>
<span id="cb36-562"><a href="#cb36-562" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-563"><a href="#cb36-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-564"><a href="#cb36-564" aria-hidden="true" tabindex="-1"></a><span class="fu">## Findings and suggestions</span></span>
<span id="cb36-565"><a href="#cb36-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-566"><a href="#cb36-566" aria-hidden="true" tabindex="-1"></a>::: justify</span>
<span id="cb36-567"><a href="#cb36-567" aria-hidden="true" tabindex="-1"></a>Based on the previous analysis we can conclude that:</span>
<span id="cb36-568"><a href="#cb36-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-569"><a href="#cb36-569" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Most member customers are Chicago locals and use Cyclistic bikes for daily routine activities, especially to commute to work.</span>
<span id="cb36-570"><a href="#cb36-570" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Casual customers are more dispersed, use Cyclistic bikes for leisure, and are more likely to be tourists.</span>
<span id="cb36-571"><a href="#cb36-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-572"><a href="#cb36-572" aria-hidden="true" tabindex="-1"></a>Being the two groups fundamentally different between each other, it might be hard to convert casuals into members. However we can provide some potentially useful suggestions anyway:</span>
<span id="cb36-573"><a href="#cb36-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-574"><a href="#cb36-574" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Gather more data on casual riders with surveys. Ask about their home addresses, daily habits, work, etc.</span>
<span id="cb36-575"><a href="#cb36-575" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Develop a dedicated social media campaign targeted at casual customers on weekends, specifically. A clever and low-cost idea might be asking the customers to share their weekend rides with Cyclistic on social media (in exchange for some discounts, etc.).</span>
<span id="cb36-576"><a href="#cb36-576" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Adopt a more flexible pricing structure, by offering something like a weekend-only membership. Also develop a plan to charge casual customers based on 'ride_length'.</span>
<span id="cb36-577"><a href="#cb36-577" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Consider cutting investments on docked bikes, and focus on non-docked ones.</span>
<span id="cb36-578"><a href="#cb36-578" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Consider an expansion to Chicago neighborhoods.</span>
<span id="cb36-579"><a href="#cb36-579" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Consider partnerships with local enterprises, like offering discounted memberships for employees.</span>
<span id="cb36-580"><a href="#cb36-580" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb36-581"><a href="#cb36-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-582"><a href="#cb36-582" aria-hidden="true" tabindex="-1"></a><span class="fu">## Source code</span></span>
<span id="cb36-583"><a href="#cb36-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-584"><a href="#cb36-584" aria-hidden="true" tabindex="-1"></a>::: justify</span>
<span id="cb36-585"><a href="#cb36-585" aria-hidden="true" tabindex="-1"></a>For a different take on this same case study, look at the <span class="co">[</span><span class="ot">source code</span><span class="co">](https://github.com/G-Bez/Cyclistic-case-study)</span> I uploaded to github, where I also used <span class="co">[</span><span class="ot">renv</span><span class="co">](https://rstudio.github.io/renv/articles/renv.html)</span> for dependency management, and <span class="co">[</span><span class="ot">targets</span><span class="co">](https://books.ropensci.org/targets/)</span> for workflow management. Follow the instructions in order to reproduce the analysis.</span>
<span id="cb36-586"><a href="#cb36-586" aria-hidden="true" tabindex="-1"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center"><div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>